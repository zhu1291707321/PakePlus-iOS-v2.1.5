import{Z as e,T as a,d as t,o as l,n as o,w as s,b as n,L as r,U as u,e as i,t as c,E as d,i as m,I as h,f as p,O as v,P as f,Q as y,S as g,R as _,K as b,D as S,N as k,r as x,j as T,C as w,y as N,v as C,ae as V,p as B,c as z,m as j,F as I,af as O,ag as $,q as J,A as U,a1 as D}from"./index-634fa69d.js";import{_ as F}from"./uni-icons.34e2de6b.js";import{r as L,o as E,b as H,c as R,d as q}from"./uni-app.es.78f2cdc8.js";import{_ as A}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as M}from"./u-icon.57682e04.js";import{_ as G}from"./u-input.0deae26b.js";import{_ as K}from"./u-back-top.e50a238f.js";import{_ as P}from"./u-line.68a19bb8.js";import{_ as Q}from"./u-loading-icon.09a3efa7.js";import{a as Z,b as W,s as X}from"./group.48718cb9.js";import{d as Y}from"./index.e8efd85e.js";import"./u-transition.cd342dbb.js";import"./request.87fc902a.js";const ee={en:{"uni-search-bar.cancel":"cancel","uni-search-bar.placeholder":"Search enter content"},"zh-Hans":{"uni-search-bar.cancel":"取消","uni-search-bar.placeholder":"请输入搜索内容"},"zh-Hant":{"uni-search-bar.cancel":"取消","uni-search-bar.placeholder":"請輸入搜索內容"}},{t:ae}=e(ee);const te=A({name:"UniSearchBar",emits:["input","update:modelValue","clear","cancel","confirm","blur","focus"],props:{placeholder:{type:String,default:""},radius:{type:[Number,String],default:5},clearButton:{type:String,default:"auto"},cancelButton:{type:String,default:"auto"},cancelText:{type:String,default:""},bgColor:{type:String,default:"#F8F8F8"},maxlength:{type:[Number,String],default:100},value:{type:[Number,String],default:""},modelValue:{type:[Number,String],default:""},focus:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},data:()=>({show:!1,showSync:!1,searchVal:""}),computed:{cancelTextI18n(){return this.cancelText||ae("uni-search-bar.cancel")},placeholderText(){return this.placeholder||ae("uni-search-bar.placeholder")}},watch:{modelValue:{immediate:!0,handler(e){this.searchVal=e,e&&(this.show=!0)}},focus:{immediate:!0,handler(e){if(e){if(this.readonly)return;this.show=!0,this.$nextTick((()=>{this.showSync=!0}))}}},searchVal(e,a){this.$emit("input",e),this.$emit("update:modelValue",e)}},methods:{searchClick(){this.readonly||this.show||(this.show=!0,this.$nextTick((()=>{this.showSync=!0})))},clear(){this.searchVal="",this.$emit("clear","")},cancel(){this.readonly||(this.$emit("cancel",{value:this.searchVal}),this.searchVal="",this.show=!1,this.showSync=!1,a())},confirm(){a(),this.$emit("confirm",{value:this.searchVal})},blur(){a(),this.$emit("blur",{value:this.searchVal})},emitFocus(e){this.$emit("focus",e.detail)}}},[["render",function(e,a,v,f,y,g){const _=L(t("uni-icons"),F),b=m,S=h,k=p;return l(),o(b,{class:"uni-searchbar"},{default:s((()=>[n(b,{style:r({borderRadius:v.radius+"px",backgroundColor:v.bgColor}),class:"uni-searchbar__box",onClick:g.searchClick},{default:s((()=>[n(b,{class:"uni-searchbar__box-icon-search"},{default:s((()=>[u(e.$slots,"searchIcon",{},(()=>[n(_,{color:"#c0c4cc",size:"18",type:"search"})]),!0)])),_:3}),y.show||y.searchVal?(l(),o(S,{key:0,focus:y.showSync,disabled:v.readonly,placeholder:g.placeholderText,maxlength:v.maxlength,class:"uni-searchbar__box-search-input","confirm-type":"search",type:"text",modelValue:y.searchVal,"onUpdate:modelValue":a[0]||(a[0]=e=>y.searchVal=e),onConfirm:g.confirm,onBlur:g.blur,onFocus:g.emitFocus},null,8,["focus","disabled","placeholder","maxlength","modelValue","onConfirm","onBlur","onFocus"])):(l(),o(k,{key:1,class:"uni-searchbar__text-placeholder"},{default:s((()=>[i(c(v.placeholder),1)])),_:1})),y.show&&("always"===v.clearButton||"auto"===v.clearButton&&""!==y.searchVal)&&!v.readonly?(l(),o(b,{key:2,class:"uni-searchbar__box-icon-clear",onClick:g.clear},{default:s((()=>[u(e.$slots,"clearIcon",{},(()=>[n(_,{color:"#c0c4cc",size:"20",type:"clear"})]),!0)])),_:3},8,["onClick"])):d("",!0)])),_:3},8,["style","onClick"]),"always"===v.cancelButton||y.show&&"auto"===v.cancelButton?(l(),o(k,{key:0,onClick:g.cancel,class:"uni-searchbar__cancel"},{default:s((()=>[i(c(g.cancelTextI18n),1)])),_:1},8,["onClick"])):d("",!0)])),_:3})}],["__scopeId","data-v-9175845b"]]);const le=A({name:"u-loadmore",mixins:[f,y,{props:{status:{type:String,default:()=>v.loadmore.status},bgColor:{type:String,default:()=>v.loadmore.bgColor},icon:{type:Boolean,default:()=>v.loadmore.icon},fontSize:{type:[String,Number],default:()=>v.loadmore.fontSize},iconSize:{type:[String,Number],default:()=>v.loadmore.iconSize},color:{type:String,default:()=>v.loadmore.color},loadingIcon:{type:String,default:()=>v.loadmore.loadingIcon},loadmoreText:{type:String,default:()=>v.loadmore.loadmoreText},loadingText:{type:String,default:()=>v.loadmore.loadingText},nomoreText:{type:String,default:()=>v.loadmore.nomoreText},isDot:{type:Boolean,default:()=>v.loadmore.isDot},iconColor:{type:String,default:()=>v.loadmore.iconColor},marginTop:{type:[String,Number],default:()=>v.loadmore.marginTop},marginBottom:{type:[String,Number],default:()=>v.loadmore.marginBottom},height:{type:[String,Number],default:()=>v.loadmore.height},line:{type:Boolean,default:()=>v.loadmore.line},lineColor:{type:String,default:()=>v.loadmore.lineColor},dashed:{type:Boolean,default:()=>v.loadmore.dashed}}}],data:()=>({dotText:"●"}),computed:{loadTextStyle(){return{color:this.color,fontSize:g(this.fontSize),lineHeight:g(this.fontSize),backgroundColor:this.bgColor}},showText(){let e="";return e="loadmore"==this.status?this.loadmoreText:"loading"==this.status?this.loadingText:"nomore"==this.status&&this.isDot?this.dotText:this.nomoreText,e}},emits:["loadmore"],methods:{addStyle:_,addUnit:g,loadMore(){"loadmore"==this.status&&this.$emit("loadmore")}}},[["render",function(e,a,u,h,v,f){const y=L(t("u-line"),P),g=L(t("u-loading-icon"),Q),_=m,S=p;return l(),o(_,{class:"u-loadmore",style:r([f.addStyle(e.customStyle),{backgroundColor:e.bgColor,marginBottom:f.addUnit(e.marginBottom),marginTop:f.addUnit(e.marginTop),height:f.addUnit(e.height)}])},{default:s((()=>[e.line?(l(),o(y,{key:0,length:"140rpx",color:e.lineColor,hairline:!1,dashed:e.dashed},null,8,["color","dashed"])):d("",!0),n(_,{class:b(["loadmore"==e.status||"nomore"==e.status?"u-more":"","u-loadmore__content"])},{default:s((()=>["loading"===e.status&&e.icon?(l(),o(_,{key:0,class:"u-loadmore__content__icon-wrap"},{default:s((()=>[n(g,{color:e.iconColor,size:e.iconSize,mode:e.loadingIcon},null,8,["color","size","mode"])])),_:1})):d("",!0),n(S,{class:b(["u-line-1",["nomore"==e.status&&1==e.isDot?"u-loadmore__content__dot-text":"u-loadmore__content__text"]]),style:r([f.loadTextStyle]),onClick:f.loadMore},{default:s((()=>[i(c(f.showText),1)])),_:1},8,["style","class","onClick"])])),_:1},8,["class"]),e.line?(l(),o(y,{key:1,length:"140rpx",color:e.lineColor,hairline:!1,dashed:e.dashed},null,8,["color","dashed"])):d("",!0)])),_:1},8,["style"])}],["__scopeId","data-v-1b766534"]]),oe=A({__name:"index",setup(e){const a=S({loadText:{loadmore:"轻轻上拉加载更多...",loading:"努力加载中...",nomore:"没有更多了"},form:{pageNum:1,pageSize:10,taskNo:"",instructionName:"",instructionStatus:null,instructionType:null,searchValue:null},total:0,showBackTop:!1}),{form:r,loadText:u,total:h,showBackTop:v}=k(a),f=x([]),y=x("loadmore"),g=x(0),_=x(!1),F=x(0),A=x(!1),P=x(null),Q=x([]),ee=x([]),ae=x([]),oe=x([]),se=x([]),ne=T((()=>{const{instructionName:e,instructionStatus:a,instructionType:t,taskNo:l}=r.value;return{instructionName:e,instructionStatus:a,instructionType:t,taskNo:l}}));E((()=>{w({title:"加载中...",mask:!0}),"notInDingTalk"!==Y.env.platform&&Y.biz.navigation.setTitle({title:"工单管理"}),Q.value=[{name:"重置/刷新",value:"all",type:"all"}],se.value=JSON.parse(JSON.stringify(Q.value)),async function(){try{const{data:e}=await Z("instruction_status");ae.value=e,Q.value.push({name:"状态",value:ae.value,list:ae.value,type:"instructionStatus"}),se.value=JSON.parse(JSON.stringify(Q.value))}catch(e){console.error("获取状态字典失败:",e)}}(),async function(){try{const{data:e}=await Z("instruction_type");oe.value=e,Q.value.push({name:"业务",value:oe.value,list:oe.value,type:"instructionType"}),se.value=JSON.parse(JSON.stringify(Q.value))}catch(e){console.error("获取业务类型字典失败:",e)}}(),ie()}));const re=()=>{y.value="loading",f.value=[],ie()};function ue(){r.value.taskNo="",r.value.instructionName="",y.value="loading",ie()}async function ie(){try{if("nomore"===y.value)return;y.value="loading",r.value.searchValue=JSON.stringify(ne.value);const{data:e}=await W({...r.value});if(!e||!e.rows||!e.total)return y.value="nomore",void(1===r.value.pageNum&&(f.value=[]));h.value=e.total;const a=e.rows||[];1===r.value.pageNum?f.value=a:f.value=[...f.value,...a],f.value.length>=h.value?y.value="nomore":(y.value="loadmore",r.value.pageNum++)}catch(e){console.error("获取数据失败:",e),y.value="error",N({title:e.msg||"加载失败",icon:"none"})}finally{C()}}const ce=()=>{"loadmore"===y.value&&ie()},de=async()=>{_.value=!0,r.value.pageNum=1,y.value="loadmore",f.value=[],await ie(),_.value=!1,g.value=0,V()},me=e=>{r.value.taskNo=e,r.value.pageNum=1,y.value="loadmore",f.value=[],g.value=0,ie()},he=e=>{const a=ae.value.find((a=>a.dictValue===e+""));return(null==a?void 0:a.dictLabel)||""};return H((()=>{r.value.pageNum=1,ie(),setTimeout((()=>{V()}),1e3)})),R((()=>{"loadmore"===y.value&&(y.value="loading",ie())})),q((e=>{v.value=e.scrollTop>200})),(e,a)=>{const h=L(t("uni-search-bar"),te),S=U,k=m,x=p,T=L(t("u-icon"),M),w=L(t("u--input"),G),C=D,V=L(t("u-back-top"),K),E=L(t("u-loadmore"),le);return l(),o(k,{class:"container"},{default:s((()=>[n(k,{class:"page-header"},{default:s((()=>[n(k,{class:"search-container"},{default:s((()=>[n(h,{class:"search-bar",modelValue:B(r).instructionName,"onUpdate:modelValue":a[0]||(a[0]=e=>B(r).instructionName=e),placeholder:"请输入工单标题/工单号",onCancel:ue,radius:"100",clearButton:!0},null,8,["modelValue"]),n(S,{class:"search-btn",size:"mini",onClick:re,disabled:!1,"hover-start-time":"20"},{default:s((()=>[i(" 搜索 ")])),_:1})])),_:1}),n(k,{class:"page-header--dropdown"},{default:s((()=>[(l(!0),z(I,null,j(Q.value,((e,a)=>(l(),o(k,{class:"dropdown-item",key:a,onClick:t=>((e,a)=>{if(F.value=a,se.value=JSON.parse(JSON.stringify(se.value)),console.log(se.value),0===a)return Q.value.forEach(((e,a)=>{const t=se.value[a];e.name=t.name,e.value=t.value,e.type=t.type,e.list=t.list})),r.value.taskNo="",r.value.pageNum=1,y.value="loadmore",f.value=[],g.value=0,r.value.instructionName="",r.value.instructionStatus=null,r.value.instructionType=null,r.value.total=0,void ie();0!==a&&(A.value=!A.value,ee.value=e.list,P.value=e.type)})(e,a)},{default:s((()=>[n(x,{class:"item-text"},{default:s((()=>[i(c(e.name),1)])),_:2},1024),0!==a?(l(),o(T,{key:0,class:"arrow-icon",name:A.value&&F.value===a?"arrow-up":"arrow-down",size:"22",color:"#999"},null,8,["name"])):d("",!0)])),_:2},1032,["onClick"])))),128)),n(k,{class:b([A.value?"dropdown-wrap":""])},{default:s((()=>[O(n(C,{class:"scroll-wrap","scroll-y":""},{default:s((()=>[n(k,{class:"dropdown-popup"},{default:s((()=>["input"==P.value?(l(),o(k,{key:0},{default:s((()=>[n(w,{placeholder:"请输入内容",border:"surround",modelValue:B(r).taskNo,"onUpdate:modelValue":a[1]||(a[1]=e=>B(r).taskNo=e),onChange:me},null,8,["modelValue"])])),_:1})):(l(!0),z(I,{key:1},j(ee.value,((e,a)=>(l(),o(k,{class:b(["popup-item",{active:Q.value[F.value].value===e.value}]),key:a,onClick:a=>(e=>{const a=Q.value[F.value];switch(Q.value[F.value].name=e.dictLabel,Q.value[F.value].value=e.dictValue,A.value=!1,a.type){case"instructionStatus":r.value.instructionStatus=e.dictValue;break;case"instructionType":r.value.instructionType=e.dictValue;break;default:r.value.instructionStatus=null,r.value.instructionType=null}r.value.pageNum=1,r.value.total=0,y.value="loadmore",f.value=[],ie()})(e)},{default:s((()=>[i(c(e.dictLabel),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1},512),[[$,A.value]])])),_:1},8,["class"])])),_:1})])),_:1}),n(C,{class:"scroll-wrap","scroll-y":"",onScrolltolower:ce,"scroll-top":g.value,"refresher-enabled":"","refresher-triggered":_.value,onRefresherrefresh:de},{default:s((()=>[n(V,{"scroll-top":g.value,top:"10"},null,8,["scroll-top"]),n(k,{class:"page-card"},{default:s((()=>[(l(!0),z(I,null,j(f.value,((e,a)=>(l(),o(k,{class:"card-item",key:e.id||a},{default:s((()=>[n(k,{class:"card-item--content",onClick:a=>{return t=e,void J({url:"/pages/group/groupOrderInfo?row="+JSON.stringify(t)});var t}},{default:s((()=>[n(k,{class:"content-line"},{default:s((()=>[n(k,{class:"title-text two-ellipsis"},{default:s((()=>[i(c(e.instructionName),1)])),_:2},1024),n(k,{class:"state-text underway"},{default:s((()=>[i(c(he(e.instructionStatus)),1)])),_:2},1024)])),_:2},1024),n(k,{class:"content-points"},{default:s((()=>[i(" 内容:"+c(e.instructionDesc),1)])),_:2},1024),n(k,{class:"content-hospital"},{default:s((()=>[n(x,{class:"hospital-tag"},{default:s((()=>[i("工单编号")])),_:1}),n(x,{class:"hospital-text"},{default:s((()=>[i(c(e.taskNo),1)])),_:2},1024)])),_:2},1024),n(k,{class:"content-time"},{default:s((()=>[i(" 下发时间："+c(e.sendTime),1)])),_:2},1024)])),_:2},1032,["onClick"]),n(k,{class:"card-item--btn"},{default:s((()=>[1==e.instructionStatus||0==e.instructionStatus?(l(),o(k,{key:0,class:"btn-item",onClick:a=>(async e=>{try{0===(await X(e)).data.code?(N({title:"签收操作成功,等待指挥平台审核",icon:"success"}),ie()):N({title:"签收操作失败",icon:"none"})}catch(a){console.error("签收操作错误:",a),N({title:"签收操作失败，请稍后再试",icon:"none"})}})(e.id)},{default:s((()=>[i(" 签收 ")])),_:2},1032,["onClick"])):d("",!0)])),_:2},1024)])),_:2},1024)))),128)),n(E,{status:y.value,loadText:B(u),"bg-color":"rgb(240, 240, 240)","margin-top":"20","margin-bottom":"20"},null,8,["status","loadText"])])),_:1})])),_:1},8,["scroll-top","refresher-triggered"]),B(v)?(l(),o(k,{key:0,class:"back-to-top",onClick:e.backToTop},{default:s((()=>[n(T,{name:"arrow-up",color:"#fff",size:"38"})])),_:1},8,["onClick"])):d("",!0)])),_:1})}}},[["__scopeId","data-v-08e7ed0b"]]);export{oe as default};
