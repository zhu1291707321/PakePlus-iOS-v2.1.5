import{J as e,r as l,d as t,o as a,c as o,b as i,a as n,F as s,m as u,p as r,n as d,w as c,e as p,E as m,t as f,K as v,i as y,D as _,l as g,q as b,H as h,C as k,v as T}from"./index-634fa69d.js";import{_ as x}from"./u-navbar.5a6ebb76.js";import{r as E,o as j,a as w}from"./uni-app.es.78f2cdc8.js";import{_ as S,a as N}from"./u-cell-group.cdda5a55.js";import{a as C,b as R,c as I,d as O}from"./uni-table.0af46610.js";import{_ as F}from"./uni-card.d07973b2.js";import{_ as L}from"./u-button.3f55f15e.js";import{_ as A}from"./u-input.0deae26b.js";import{_ as U,a as B}from"./u-form.9aed71e3.js";import{o as V,_ as $}from"./excel.b0ec50db.js";import{_ as z,a as D}from"./uni-popup.9671773e.js";import{s as K,O as q,c as P,e as J,f as M,j as H}from"./workorder.a3c585f7.js";import{d as X,f as W}from"./common.c1fe3543.js";import{_ as G}from"./uni-section.1a5d770b.js";import{_ as Q}from"./u-icon.57682e04.js";import{_ as Y}from"./u-tag.3fd9e2ae.js";import{_ as Z}from"./u-line.68a19bb8.js";import{_ as ee,a as le}from"./u-radio-group.5f722b56.js";import{_ as te}from"./u-modal.31d8c562.js";import{d as ae}from"./index.e8efd85e.js";import{_ as oe}from"./_plugin-vue_export-helper.1b428a4d.js";import"./FileSaver.min.c18a2d77.js";import"./uni-icons.34e2de6b.js";import"./u-loading-icon.09a3efa7.js";import"./request.87fc902a.js";import"./u-transition.cd342dbb.js";import"./u-overlay.ad05817b.js";const ie=oe({__name:"RecordCity",props:{history:{type:Object},bossExamine:{type:Boolean},order:{type:Object}},emits:["func"],setup(_,{emit:g}){const b=e("user"),h=l({desc:"",state:6,id:null,orderId:null,deptId:null}),k=g,T=l(null),x=l(!1);l(!1);const j=l({desc:{type:"string",required:!0,message:"请填写姓名",trigger:["blur"]}});function w(){x.value=!1}const S=()=>{T.value.validate().then((e=>{e?(console.log(h),K(h.value).then((e=>{k("func","click")})),x.value=!1):(uni.$u.toast("校验失败"),x.value=!0)})).catch((()=>{uni.$u.toast("校验失败")}))};return(e,l)=>{const g=E(t("uni-section"),G),k=E(t("up-icon"),Q),N=E(t("up-button"),L),C=E(t("up-tag"),Y),R=E(t("uni-card"),F),I=y,O=E(t("up-line"),Z),$=E(t("up-input"),A),z=E(t("up-form-item"),U),D=E(t("up-radio"),ee),K=E(t("up-radio-group"),le),q=E(t("up-form"),B),P=E(t("up-modal"),te);return a(),o("div",{class:"record"},[i(g,{title:"流转记录",type:"line",titleFontSize:"18px"}),n("div",{class:"record_box"},[(a(!0),o(s,null,u(_.history,((e,l)=>(a(),o("div",{class:"record_item",key:l},[n("div",{class:"record_left"},[i(k,{name:"checkmark-circle",color:e.endTime?"rgb(43, 196, 24)":"#dfe4ed",size:"20"},null,8,["color"]),n("div",{class:"record_left_line"})]),n("div",{class:"record_right"},[7==e.state&&_.bossExamine&&e.assigneeId==r(b).deptId?(a(),d(N,{key:0,type:"primary",style:{width:"100px"},size:"small",onClick:l=>{return t=e.id,a=r(b).deptId,h.value.id=t,h.value.deptId=a,h.value.desc=null,h.value.state=6,void(x.value=!0);var t,a}},{default:c((()=>[p("领导审核")])),_:2},1032,["onClick"])):m("",!0),n("div",{class:"record_right_title"},["USER_TASK"===e.activityType?(a(),o("div",{key:0},f(e.activityName)+"的任务",1)):(a(),o("div",{key:1},f(e.activityName),1)),n("div",{classs:"record_content_tag"},["USER_TASK"===e.activityType&&1==e.state?(a(),d(C,{key:0,plain:"",plainFill:"",text:"待签收"})):m("",!0),"USER_TASK"===e.activityType&&5==e.state?(a(),d(C,{key:1,plain:"",plainFill:"",type:"success",text:"待反馈"})):m("",!0),"USER_TASK"===e.activityType&&6==e.state?(a(),d(C,{key:2,plain:"",plainFill:"",type:"success",text:"待审核"})):m("",!0),"USER_TASK"===e.activityType&&2==e.state?(a(),d(C,{key:3,plain:"",plainFill:"",type:"info",text:"驳回"})):m("",!0),"USER_TASK"===e.activityType&&3==e.state?(a(),d(C,{key:4,plain:"",plainFill:"",type:"warning",text:"完成"})):m("",!0),"USER_TASK"===e.activityType&&7==e.state?(a(),d(C,{key:5,plain:"",plainFill:"",type:"info",text:"待部门领导审核"})):m("",!0),"USER_TASK"===e.activityType&&8==e.state?(a(),d(C,{key:6,plain:"",plainFill:"",type:"warning",text:"部门领导驳回"})):m("",!0)])]),n("div",{class:"record_right_content"},[i(I,{class:v(e.assigneeId===r(b).deptId?"active_card":"")},{default:c((()=>["START_EVENT"===e.activityType?(a(),d(R,{key:0,class:"box-card",shadow:"hover"},{default:c((()=>[p(f(e.assigneeName)+" 在 "+f(e.createTime)+" 进行 "+f(e.activityName),1)])),_:2},1024)):m("",!0),"EXAMINE"===e.activityType?(a(),d(R,{key:1,class:"box-card",shadow:"hover"},{default:c((()=>[p(f(e.examineName)+" 在 "+f(e.createTime)+" 进行 "+f(e.activityName)+" ",1),2==e.state?(a(),o("span",{key:0,style:{color:"red"}},"审核结果:拒绝")):m("",!0),1==e.state?(a(),o("span",{key:1,style:{color:"aquamarine"}},"审核结果:通过")):m("",!0),p(" 审核内容： "+f(e.examineContent),1)])),_:2},1024)):m("",!0),"USER_TASK"===e.activityType?(a(),d(R,{key:2,class:"box-card",shadow:"hover"},{default:c((()=>[i(I,{class:"record_content_list"},{default:c((()=>[i(I,{class:"record_content_item"},{default:c((()=>[i(I,null,{default:c((()=>[p("专员名单:")])),_:1}),i(I,null,{default:c((()=>[p(f(null!=e.assigneeName?JSON.parse(e.assigneeName).join():"-"),1)])),_:2},1024)])),_:2},1024),i(I,{class:"record_content_item"},{default:c((()=>[i(I,null,{default:c((()=>[p("下发时间:")])),_:1}),i(I,null,{default:c((()=>[p(f(e.createTime||"-"),1)])),_:2},1024)])),_:2},1024),i(I,{class:"record_content_item"},{default:c((()=>[i(I,null,{default:c((()=>[p("签收时间:")])),_:1}),i(I,null,{default:c((()=>[p(f(e.signTime||"-"),1)])),_:2},1024)])),_:2},1024),i(I,{class:"record_content_item"},{default:c((()=>[i(I,null,{default:c((()=>[p("反馈时间:")])),_:1}),i(I,null,{default:c((()=>[p(f(e.feedbackTime||"-"),1)])),_:2},1024)])),_:2},1024),i(I,{class:"record_content_item"},{default:c((()=>[i(I,null,{default:c((()=>[p("结束时间:")])),_:1}),i(I,null,{default:c((()=>[p(f(e.endTime||"-"),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),e.reviewContent&&e.reviewContent.length>0?(a(),o("div",{key:0},[(a(!0),o(s,null,u(e.reviewContent,((e,l)=>(a(),o("div",{key:l},[i(I,{class:"record_createTime_row"},{default:c((()=>[i(O,{dashed:"",color:"#333",margin:"10rpx 0",length:"10%"}),i(C,{class:"record_createTime_row_tag",type:"info",plain:"",size:"mini",text:e.createTime},null,8,["text"]),i(O,{dashed:"",color:"#333",margin:"10rpx 0",length:"30%"})])),_:2},1024),i(I,{class:"record_content_list"},{default:c((()=>[i(I,{class:"record_content_item"},{default:c((()=>[i(I,null,{default:c((()=>[p("操作人:")])),_:1}),i(I,null,{default:c((()=>[p(f(e.name),1)])),_:2},1024)])),_:2},1024),i(I,{class:"record_content_item"},{default:c((()=>[i(I,null,{default:c((()=>[p("操作内容:")])),_:1}),i(I,null,{default:c((()=>[p(f(e.fullMessage),1)])),_:2},1024)])),_:2},1024),i(I,{class:"record_content_item"},{default:c((()=>[i(I,null,{default:c((()=>[p("操作类型:")])),_:1}),i(I,null,{default:c((()=>[p(f("BOOS_EXAMINE_NO"===e.type?"部门领导审核(驳回)":"BOOS_EXAMINE_OK"===e.type?"部门领导审核(通过)":"RESPONSE_EXAMINE"===e.type?"审核(通过)":"RESPONSE_REJECT"===e.type?"审核(驳回)":"RESPONSE"===e.type?"反馈":"签收"),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),e.inputFields&&e.inputFields.length>0?(a(),o("div",{key:0},[n("span",null,[n("b",null,"附加字段:")]),(a(!0),o(s,null,u(e.inputFields,((e,l)=>(a(),o("span",{key:l,style:{"margin-right":"20rpx"}},"   "+f(e.name)+" : "+f(e.value),1)))),128))])):m("",!0),e.fileIdList&&e.fileIdList.length>0?(a(),o("div",{key:1,class:"flex items-center"},[n("span",null,[n("b",null,"附件:"),p("    ")]),(a(!0),o(s,null,u(e.fileIdList,((e,l)=>(a(),o("span",{key:l},[n("div",{style:{color:"rgb(41, 121, 255)","text-decoration":"underline"},onClick:l=>function(e){e.id&&("notInDingTalk"===ae.env.platform?X({id:e.id}).then((l=>{let t="blob";".png"!==e.fileType&&".jpg"!==e.fileType&&".jpeg"!==e.fileType||(t="arraybuffer");const a=new Blob([l],{type:t}),o=URL.createObjectURL(a),i=document.createElement("a");i.style.display="none",i.href=o,i.setAttribute("download",`${e.orName}${e.fileType}`),document.body.appendChild(i),console.log(i,"link"),i.click(),document.body.removeChild(i)})).catch((e=>{console.error("请求失败:",e)})):V("1",e.id,e.fileType,e.orName))}(e)},f(e.orName),9,["onClick"])])))),128))])):m("",!0)])))),128))])):m("",!0)])),_:2},1024)):m("",!0),"END_EVENT"===e.activityType?(a(),d(R,{key:3,class:"box-card",shadow:"hover"},{default:c((()=>[p(f(e.createTime)+" 结束流程",1)])),_:2},1024)):m("",!0)])),_:2},1032,["class"])])])])))),128))]),i(I,{class:""},{default:c((()=>[i(P,{show:r(x),buttonReverse:!0,onCancel:w,showCancelButton:!0,onConfirm:S,ref:"uModal"},{default:c((()=>[i(q,{labelWidth:"80",labelPosition:"left",model:r(h),ref_key:"uFormRef",ref:T,rules:r(j)},{default:c((()=>[i(z,{label:"审核内容",prop:"desc",borderBottom:"",ref:"item1"},{default:c((()=>[i($,{modelValue:r(h).desc,"onUpdate:modelValue":l[0]||(l[0]=e=>r(h).desc=e)},null,8,["modelValue"])])),_:1},512),i(z,{label:"是否同意",prop:"state",borderBottom:"",ref:"item2"},{default:c((()=>[i(K,{modelValue:r(h).state,"onUpdate:modelValue":l[1]||(l[1]=e=>r(h).state=e),placement:"row"},{default:c((()=>[i(D,{customStyle:{marginBottom:"8px"},label:"同意",name:6}),i(D,{customStyle:{marginBottom:"8px"},label:"驳回",name:8})])),_:1},8,["modelValue"])])),_:1},512)])),_:1},8,["model","rules"])])),_:1},8,["show"])])),_:1})])}}},[["__scopeId","data-v-10ab1274"]]),ne=oe({__name:"OrderInfoCity",setup(v){j((()=>{"notInDingTalk"!==ae.env.platform&&ae.biz.navigation.setTitle({title:"工单详情"})}));const y=()=>{le(se.value),ne(se.value),console.log("父组件的方法")};l(!0);const K=l(!0),G=l(),Q=l();l();const Y=l([]),Z=l([]),ee=l();async function le(e){const{data:l}=await P(e);K.value=l,console.log(K.value,"info.value");const t=K.value.formValues,a=JSON.parse(t);G.value=K.value.serviceType;for(let i of oe.value)Q.value=i.dictValue,Q.value===G.value&&(console.log(i.dictLabel,"dictLabel"),ee.value=i.dictLabel);console.log(G.value,"serviceType");const o=Object.keys(a.formShowData);Y.value=o;for(let i in a.formShowData)Z.value.push(a.formShowData[i]);re.inputFields=JSON.parse(JSON.stringify(K.value.inputFields.map((e=>(null===e.value&&(e.value=""),e)))))}const te=l({history:[]}),oe=l();async function ne(e){const{data:l}=await J(e);te.value=l,console.log(te.value,"123")}!async function(){const{data:e}=await q();oe.value=e,console.log(oe.value,"serviceRange.value")}();const se=l();w((e=>{se.value=e.id,le(e.id),ne(e.id)}));const ue=l(null),re=_({content:"",fileIdList:[],inputFields:[],leaderExamine:null}),de=l({content:{type:"string",required:!0,message:"请输入",trigger:["blur"]},fileIdList:{required:!0,message:"请上传",trigger:["blur"]}});g((()=>re.inputFields),(()=>{}));const ce=l(null);const pe=l([]),me=async e=>{let l=[].concat(e.file),t=pe.value.length;l.map((e=>{pe.value.push({...e,status:"uploading",message:"上传中"})}));for(let a=0;a<l.length;a++){const e=await ve(l[a].url);console.log(e,"data1"),re.fileIdList.push(e);let o=pe.value[t];pe.value.splice(t,1,{...o,status:"success"}),t++}},fe=e=>{pe.value.splice(e.index,1),re.fileIdList.splice(e.index,1)},ve=l=>new Promise(((t,a)=>{h({url:"https://58.20.99.151:9000/dev-api/system/files/upload",filePath:l,name:"file",header:{Authorization:"Bearer "+e("token")},success:e=>{const l=JSON.parse(e.data);t(l.data)}})}));function ye(){ce.value.close(),fe(event),re.content=""}function _e(){ue.value.validate().then((e=>{e?async function(){console.log(K.value,"params");try{const{data:e}=await M({...re,id:te.value.itemId,leaderExamine:K.value.leaderExamine});ye(),uni.$u.toast("反馈成功"),ne(se.value)}catch(e){}}():uni.$u.toast("请填写完整信息")})).catch((()=>{uni.$u.toast("请填写完整信息")}))}const ge=l(null);function be(){ge.value.open("center")}function he(){ge.value.close()}async function ke(){try{const{data:e}=await H(te.value.itemId);console.log(te.value.itemId,"-=="),he(),uni.$u.toast("签收成功"),ne(se.value)}catch(e){}}function Te(){b({url:"/pages/workorder/Audit?id="+se.value})}return l([]),(e,l)=>{const v=E(t("up-navbar"),x),_=E(t("up-cell"),S),g=E(t("uni-th"),C),b=E(t("uni-tr"),R),h=E(t("uni-td"),I),j=E(t("uni-table"),O),w=E(t("up-cell-group"),N),q=E(t("uni-card"),F),P=E(t("up-button"),L),J=E(t("up-input"),A),M=E(t("up-form-item"),U),H=E(t("up-upload"),$),G=E(t("up-form"),B),Q=E(t("uni-popup-dialog"),z),le=E(t("uni-popup"),D);return a(),o("div",{class:"orderinfo_view"},[i(v,{title:"工单详情",autoBack:!0}),i(q,null,{default:c((()=>[K.value?(a(),d(w,{key:0,style:{"font-weight":"bold",color:"black"}},{default:c((()=>[i(_,{title:"标题",value:K.value.eventTitle},null,8,["value"]),i(_,{title:"工单等级",value:K.value.riskLevel},null,8,["value"]),i(_,{title:"业务类型",value:ee.value},null,8,["value"]),i(_,{title:"内容",style:{"font-weight":"bold",color:"black"}},{value:c((()=>[n("div",{innerHTML:K.value.remark},null,8,["innerHTML"])])),_:1}),i(_,{title:"反馈人员"},{value:c((()=>{var e;return[n("div",{class:"w-[400rpx]",style:{display:"flex","justify-content":"flex-end"}},f((null==(e=K.value.deptName)?void 0:e.join())||""),1)]})),_:1}),i(_,{title:"反馈地市"},{value:c((()=>{var e;return[n("div",{class:"w-[400rpx]",style:{display:"flex","justify-content":"flex-end"}},f((null==(e=K.value.cityName)?void 0:e.join())||""),1)]})),_:1}),i(_,{title:"审核人",value:K.value.examineName},null,8,["value"]),i(_,{title:"反馈超时时间",value:K.value.feedbackOutTime},null,8,["value"]),i(_,{title:"签收超时时间",value:K.value.responseOutTime},null,8,["value"]),i(_,{title:K.value.description},{value:c((()=>[i(j,{border:"",stripe:""},{default:c((()=>[i(b,null,{default:c((()=>[i(g,{align:"center"},{default:c((()=>[p(f(Y.value[0]),1)])),_:1}),i(g,{align:"center"},{default:c((()=>[p(f(Y.value[1]),1)])),_:1})])),_:1}),i(b,null,{default:c((()=>[i(h,{align:"center"},{default:c((()=>[p(f(Z.value[0]),1)])),_:1}),i(h,{align:"center"},{default:c((()=>[p(f(Z.value[1]),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["title"]),i(_,{title:"附件"},{value:c((()=>[n("div",null,[(a(!0),o(s,null,u(K.value.file,((e,l)=>(a(),o("div",{class:"w-[400rpx]",key:l},[n("div",{style:{color:"rgb(41, 121, 255)","text-decoration":"underline"},onClick:l=>function(e){if(e.id)"notInDingTalk"===ae.env.platform?X({id:e.id}).then((l=>{let t="blob";".png"!==e.fileType&&".jpg"!==e.fileType&&".jpeg"!==e.fileType||(t="arraybuffer");const a=new Blob([l],{type:t}),o=URL.createObjectURL(a),i=document.createElement("a");i.style.display="none",i.href=o,i.setAttribute("download",`${e.orName}${e.fileType}`),document.body.appendChild(i),console.log(i,"link"),i.click(),document.body.removeChild(i)})).finally((()=>{k({title:"加载中",mask:!0}),setTimeout((()=>{T()}),1e3)})).catch((e=>{console.error("请求失败:",e)})):V("1",e.id,e.fileType,e.orName);else if("notInDingTalk"===ae.env.platform){const{fileContent:l,orName:t}=e;console.log(l),W(l).then((l=>{let t="blob";".png"!==e.fileType&&".jpg"!==e.fileType&&".jpeg"!==e.fileType||(t="arraybuffer");const a=new Blob([l],{type:t}),o=URL.createObjectURL(a),i=document.createElement("a");i.style.display="none",i.href=o,i.setAttribute("download",`${e.orName}`),document.body.appendChild(i),console.log(i,"link"),i.click(),document.body.removeChild(i)})).catch((e=>{this.$message.error("下载异常请联系管理员")}))}else{const{fileContent:l,orName:t}=e;V("2",l,t)}}(e)},f(e.orName),9,["onClick"])])))),128))])])),_:1}),i(ie,{history:te.value.history,onFunc:y,bossExamine:te.value.bossExamine,orderId:K.value.id},null,8,["history","bossExamine","orderId"])])),_:1})):m("",!0)])),_:1}),n("div",{class:"orderinfo_footer"},[1==K.value.leaderExamine?(a(),o("div",{key:0,style:{"margin-right":"30px"}},[i(P,{type:"error",size:"small",text:"该工单需部门领导审核"})])):m("",!0),8==te.value.state&&te.value.isResponse||5==te.value.state&&te.value.isResponse||6==te.value.state&&te.value.isResponse||2==te.value.state&&te.value.isResponse?(a(),o("div",{key:1,class:"footer_btn",onClick:l[0]||(l[0]=e=>(K.value.leaderExamine,void ce.value.open("center")))},[i(P,{type:"primary",size:"small",text:"反馈"})])):m("",!0),1===te.value.state&&te.value.isResponse?(a(),o("div",{key:2,class:"footer_btn",onClick:be},[i(P,{type:"primary",size:"small",text:"签收"})])):m("",!0),te.value.isExamine?(a(),o("div",{key:3,class:"footer_btn",onClick:Te},[i(P,{type:"warning",size:"small",text:"审核"})])):m("",!0)]),i(le,{ref_key:"transferPopupRef",ref:ce,type:"dialog"},{default:c((()=>[i(Q,{mode:"input",title:"反馈","before-close":!0,onClose:ye,onConfirm:_e},{default:c((()=>[i(G,{labelPosition:"left",model:r(re),rules:de.value,labelWidth:"50px",ref_key:"TransferFormRef",ref:ue},{default:c((()=>[i(M,{label:"内容",prop:"content",borderBottom:"",required:""},{default:c((()=>[i(J,{placeholder:"请输入内容",border:"surround",modelValue:r(re).content,"onUpdate:modelValue":l[1]||(l[1]=e=>r(re).content=e)},null,8,["modelValue"])])),_:1}),i(M,{label:"上传",prop:"fileList",borderBottom:""},{default:c((()=>[i(H,{fileList:pe.value,onAfterRead:me,onDelete:fe,name:"1",multiple:"",maxCount:10,previewFullImage:!0,accept:"file,image"},null,8,["fileList"])])),_:1}),(a(!0),o(s,null,u(r(re).inputFields,((e,l)=>(a(),d(M,{required:"",key:l,label:e.name,prop:"inputFields["+l+"].value",borderBottom:""},{default:c((()=>[i(J,{placeholder:"请输入内容",border:"surround",modelValue:e.value,"onUpdate:modelValue":l=>e.value=l},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label","prop"])))),128))])),_:1},8,["model","rules"])])),_:1})])),_:1},512),i(le,{ref_key:"delegatePopupRef",ref:ge,type:"dialog"},{default:c((()=>[i(Q,{title:"签收","before-close":!0,onClose:he,onConfirm:ke})])),_:1},512)])}}},[["__scopeId","data-v-4b7473f5"]]);export{ne as default};
