import{v as e,r as a,D as l,N as s,o,n as t,w as u,i as n,b as r,e as i,K as c,p as d,a as m,t as p,C as f,y as g,q as v,f as h,d as _,s as b,B as y}from"./index-634fa69d.js";import{_ as w}from"./u-input.0deae26b.js";import{o as k,r as C}from"./uni-app.es.78f2cdc8.js";import{_ as x,a as V}from"./u-form.9aed71e3.js";import{_ as j}from"./u-icon.57682e04.js";import{_ as I}from"./u-button.3f55f15e.js";import{a as $,s as B,l as F,b as R}from"./login.e0b6d30e.js";import{d as q}from"./index.e8efd85e.js";import{_ as z}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-line.68a19bb8.js";import"./u-loading-icon.09a3efa7.js";import"./request.87fc902a.js";const U=z({__name:"index",setup(z){k((()=>{"notInDingTalk"!==q.env.platform&&q.biz.navigation.setTitle({title:"登录"}),setTimeout((()=>{e()}),2e3)}));const U=a("");function T(){$().then((e=>{U.value=e.data.img,Z.value.uuid=e.data.uuid}))}T();const A=a("account"),D=a(!1);a(!1),a(!1);const G=a(!1),H=a(0);a("1 + 1");const K=a(null),N=a(null),W=l({userInfo:{username:"",password:"",code:"",uuid:"",phone:"",smsCode:""},rules:{username:{type:"string",required:!0,message:"请填写用户名",trigger:["blur"]},password:{type:"string",required:!0,message:"请填写密码",trigger:["blur"]},code:{type:"string",required:!0,message:"请填写验证码",trigger:["blur"]}}}),{userInfo:Z,rules:E}=s(W),J=a(null);l({phone:"",smsCode:""});const L=e=>{S.value="account"!==e,A.value=e},M=()=>{D.value=!D.value},O=(e,a)=>{const l="accountFormRef"===e?K.value:N.value;l&&l.validateField(a)};async function P(){try{if(!/^1[3-9]\d{9}$/.test(Z.value.phone))return void uni.$u.toast("请输入正确的手机号");f({title:"发送中...",mask:!0});const e=await B(Z.value.phone);if(200===e.code){uni.$u.toast("验证码已发送"),H.value=60;const e=setInterval((()=>{H.value--,H.value<=0&&clearInterval(e)}),1e3)}else uni.$u.toast(e.msg)}catch(a){uni.$u.toast(a.msg||"发送失败")}finally{e()}}function Q(e){return/^[A-Za-z\s]*$/.test(e)}const S=a(!1);const X=async()=>{try{if(S.value){if(!/^1[3-9]\d{9}$/.test(Z.value.phone))return void uni.$u.toast("请输入正确的手机号")}else{if(!(await J.value.validate()))return}G.value=!0,async function(){try{let e;f({title:"登录中...",mask:!0}),e=S.value?await F({phonenumber:Z.value.phone,smsCode:Z.value.smsCode}):await R(Z.value);const{data:a,code:l,msg:s}=e;200===l?(b("token",a.token),b("user",a.user),y({url:"/pages/home/index"})):uni.$u.toast(Q(s)?"账号/手机号/密码错误":s)}catch(a){S.value||(Z.value.code="",T()),uni.$u.toast(Q(a.msg)?"账号/手机号/密码错误":a.msg)}finally{e(),G.value=!1}}()}catch(a){G.value=!1,g({title:"请填写完整信息",icon:"none"})}},Y=()=>{v({url:"/pages/register/index"})};return(e,a)=>{const l=n,s=h,f=C(_("u-input"),w),g=C(_("u-form-item"),x),v=C(_("u-icon"),j),b=C(_("u-form"),V),y=C(_("u-button"),I);return o(),t(l,{class:"login-container"},{default:u((()=>[r(l,{class:"login-content"},{default:u((()=>[r(l,{class:"login-header"},{default:u((()=>[r(l,{class:"logo"},{default:u((()=>[r(l,{class:"logo-shield"})])),_:1}),r(s,{class:"title"},{default:u((()=>[i("欢迎登录")])),_:1}),r(s,{class:"subtitle"},{default:u((()=>[i("Welcome Back")])),_:1})])),_:1}),r(l,{class:"login-card"},{default:u((()=>[r(l,{class:"login-tabs"},{default:u((()=>[r(l,{class:c(["tab-item",{active:"account"===A.value}]),onClick:a[0]||(a[0]=e=>L("account"))},{default:u((()=>[i(" 账号登录 ")])),_:1},8,["class"]),r(l,{class:c(["tab-item",{active:"phone"===A.value}]),onClick:a[1]||(a[1]=e=>L("phone"))},{default:u((()=>[i(" 手机登录 ")])),_:1},8,["class"])])),_:1}),"account"===A.value?(o(),t(l,{key:0,class:"login-form"},{default:u((()=>[r(b,{model:d(Z),rules:d(E),ref_key:"formRef",ref:J},{default:u((()=>[r(g,{label:"用户名",prop:"username","label-width":"80"},{default:u((()=>[r(f,{modelValue:d(Z).username,"onUpdate:modelValue":a[2]||(a[2]=e=>d(Z).username=e),placeholder:"请输入用户名",prefixIcon:"account",clearable:"",onBlur:a[3]||(a[3]=e=>O("accountFormRef","username"))},null,8,["modelValue"])])),_:1}),r(g,{label:"密码",prop:"password","label-width":"80"},{default:u((()=>[r(f,{modelValue:d(Z).password,"onUpdate:modelValue":a[4]||(a[4]=e=>d(Z).password=e),placeholder:"请输入密码",prefixIcon:"lock",password:!D.value,clearable:"",onBlur:a[5]||(a[5]=e=>O("accountFormRef","password"))},{suffix:u((()=>[r(v,{name:D.value?"eye-fill":"eye-off",onClick:M,size:"20"},null,8,["name"])])),_:1},8,["modelValue","password"])])),_:1}),r(g,{label:"验证码",prop:"code","label-width":"80"},{default:u((()=>[r(l,{class:"captcha-row"},{default:u((()=>[r(f,{modelValue:d(Z).code,"onUpdate:modelValue":a[6]||(a[6]=e=>d(Z).code=e),placeholder:"请输入验证码",prefixIcon:"photo",class:"captcha-input",clearable:"",onBlur:a[7]||(a[7]=e=>O("accountFormRef","captcha"))},null,8,["modelValue"]),m("img",{class:"captcha-img",src:"data:image/png;base64,"+U.value,onClick:T},null,8,["src"])])),_:1})])),_:1})])),_:1},8,["model","rules"]),r(y,{type:"primary",shape:"circle",color:"linear-gradient(to right, #ff4d4d, #cc0000)",onClick:X,loading:G.value,class:"login-btn"},{default:u((()=>[i(" 登录 ")])),_:1},8,["loading"])])),_:1})):(o(),t(l,{key:1,class:"phone-login-form"},{default:u((()=>[r(b,{model:d(Z),ref_key:"phoneFormRef",ref:N},{default:u((()=>[r(g,{label:"手机号","label-width":"80"},{default:u((()=>[r(f,{modelValue:d(Z).phone,"onUpdate:modelValue":a[8]||(a[8]=e=>d(Z).phone=e),placeholder:"请输入手机号",prefixIcon:"phone",clearable:"",onBlur:a[9]||(a[9]=e=>O("phoneFormRef","phone"))},null,8,["modelValue"])])),_:1}),r(g,{label:"短信验证码","label-width":"80"},{default:u((()=>[r(l,{class:"sms-code-row"},{default:u((()=>[r(f,{modelValue:d(Z).smsCode,"onUpdate:modelValue":a[10]||(a[10]=e=>d(Z).smsCode=e),placeholder:"请输入验证码",prefixIcon:"chat",class:"sms-input",clearable:"",onBlur:a[11]||(a[11]=e=>O("phoneFormRef","smsCode"))},null,8,["modelValue"]),r(y,{type:"primary",size:"mini",disabled:H.value>0,onClick:P,plain:"",class:"sms-btn"},{default:u((()=>[i(p(H.value>0?`${H.value}秒后重试`:"获取验证码"),1)])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1},8,["model"]),r(y,{type:"primary",shape:"circle",color:"linear-gradient(to right, #ff4d4d, #cc0000)",onClick:X,loading:G.value,class:"login-btn"},{default:u((()=>[i(" 登录 ")])),_:1},8,["loading"])])),_:1})),r(l,{class:"register-link"},{default:u((()=>[r(s,null,{default:u((()=>[i("还没有账号?")])),_:1}),r(s,{class:"register-text",onClick:Y},{default:u((()=>[i("立即注册")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-bbe2db86"]]);export{U as default};
