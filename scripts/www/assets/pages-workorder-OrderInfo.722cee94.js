import{r as e,D as l,l as a,o as t,c as o,b as n,w as i,a as u,E as s,q as r,n as d,t as c,e as p,F as v,m,p as f,H as y,J as g,d as b}from"./index-634fa69d.js";import{_,a as h}from"./u-cell-group.cdda5a55.js";import{o as j,a as k,r as w}from"./uni-app.es.78f2cdc8.js";import{a as x,b as L,c as R,d as T}from"./uni-table.0af46610.js";import{_ as C}from"./uni-card.d07973b2.js";import{_ as I}from"./u-button.3f55f15e.js";import{_ as N}from"./u-input.0deae26b.js";import{_ as O,a as F}from"./u-form.9aed71e3.js";import{o as D,_ as V}from"./excel.b0ec50db.js";import{_ as S,a as q}from"./uni-popup.9671773e.js";import{O as B,c as U,l as $,h as z,d as J}from"./workorder.a3c585f7.js";import{d as A,b as E}from"./common.c1fe3543.js";import{R as P}from"./Record.3dcbcd14.js";import"./FileSaver.min.c18a2d77.js";import{d as H}from"./index.e8efd85e.js";import{_ as G}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-icon.57682e04.js";import"./u-line.68a19bb8.js";import"./uni-icons.34e2de6b.js";import"./u-loading-icon.09a3efa7.js";import"./request.87fc902a.js";import"./uni-section.1a5d770b.js";import"./u-tag.3fd9e2ae.js";import"./u-transition.cd342dbb.js";const M=G({__name:"OrderInfo",setup(G){j((()=>{"notInDingTalk"!==H.env.platform&&H.biz.navigation.setTitle({title:"工单详情"})})),e(!0);const M=e(!0),Q=e(),W=e(),K=e([]),X=e([]),Y=e();const Z=e({history:[]}),ee=e();async function le(e){const{data:l}=await $(e);Z.value=l,console.log(Z.value,"123")}!async function(){const{data:e}=await B();ee.value=e,console.log(ee.value,"serviceRange.value")}();const ae=e();k((e=>{ae.value=e.id,async function(e){const{data:l}=await U(e);M.value=l,console.log(M.value,"info.value");const a=M.value.formValues,t=JSON.parse(a);Q.value=M.value.serviceType;for(let n of ee.value)W.value=n.dictValue,W.value===Q.value&&(console.log(n.dictLabel,"dictLabel"),Y.value=n.dictLabel);console.log(Q.value,"serviceType");const o=Object.keys(t.formShowData);K.value=o;for(let n in t.formShowData)X.value.push(t.formShowData[n]);oe.inputFields=JSON.parse(JSON.stringify(M.value.inputFields.map((e=>(null===e.value&&(e.value=""),e)))))}(e.id),le(e.id)}));const te=e(null),oe=l({content:"",fileIdList:[],inputFields:[]}),ne=e({content:{type:"string",required:!0,message:"请输入",trigger:["blur"]},fileIdList:{required:!0,message:"请上传",trigger:["blur"]}});a((()=>oe.inputFields),(()=>{}));const ie=e(null);function ue(){ie.value.open("center")}const se=e([]),re=async e=>{let l=[].concat(e.file),a=se.value.length;l.map((e=>{se.value.push({...e,status:"uploading",message:"上传中"})}));for(let t=0;t<l.length;t++){const e=await ce(l[t].url);console.log(e,"data1"),oe.fileIdList.push(e);let o=se.value[a];se.value.splice(a,1,{...o,status:"success"}),a++}},de=e=>{se.value.splice(e.index,1),oe.fileIdList.splice(e.index,1)},ce=e=>new Promise(((l,a)=>{y({url:"https://58.20.99.151:9000/dev-api/system/files/upload",filePath:e,name:"file",header:{Authorization:"Bearer "+g("token")},success:e=>{const a=JSON.parse(e.data);l(a.data)}})}));function pe(){ie.value.close(),de(event),oe.content=""}function ve(){te.value.validate().then((e=>{e?async function(){try{const{data:e}=await z({...oe,id:Z.value.itemId});pe(),uni.$u.toast("反馈成功"),le(ae.value)}catch(e){}}():uni.$u.toast("请填写完整信息")})).catch((()=>{uni.$u.toast("请填写完整信息")}))}const me=e(null);function fe(){me.value.open("center")}function ye(){me.value.close()}async function ge(){try{const{data:e}=await J(Z.value.itemId);console.log(Z.value.itemId,"-=="),ye(),uni.$u.toast("签收成功"),le(ae.value)}catch(e){}}function be(){r({url:"/pages/workorder/Audit?id="+ae.value})}return e([]),(e,l)=>{const a=w(b("up-cell"),_),r=w(b("uni-th"),x),y=w(b("uni-tr"),L),g=w(b("uni-td"),R),j=w(b("uni-table"),T),k=w(b("up-cell-group"),h),B=w(b("uni-card"),C),U=w(b("up-button"),I),$=w(b("up-input"),N),z=w(b("up-form-item"),O),J=w(b("up-upload"),V),G=w(b("up-form"),F),Q=w(b("uni-popup-dialog"),S),W=w(b("uni-popup"),q);return t(),o("div",{class:"orderinfo_view"},[n(B,null,{default:i((()=>[M.value?(t(),d(k,{key:0},{default:i((()=>[n(a,{title:"标题",value:M.value.eventTitle},null,8,["value"]),n(a,{title:"工单等级",value:M.value.riskLevel},null,8,["value"]),n(a,{title:"业务类型",value:Y.value},null,8,["value"]),n(a,{title:"内容",value:M.value.remark},null,8,["value"]),n(a,{title:"反馈人员"},{value:i((()=>{var e;return[u("div",{class:"w-[400rpx]",style:{display:"flex","justify-content":"flex-end"}},c((null==(e=M.value.deptName)?void 0:e.join())||""),1)]})),_:1}),n(a,{title:"审核人",value:M.value.examineName},null,8,["value"]),n(a,{title:"反馈超时时间",value:M.value.feedbackOutTime},null,8,["value"]),n(a,{title:"签收超时时间",value:M.value.responseOutTime},null,8,["value"]),n(a,{title:M.value.description},{value:i((()=>[n(j,{border:"",stripe:""},{default:i((()=>[n(y,null,{default:i((()=>[n(r,{align:"center"},{default:i((()=>[p(c(K.value[0]),1)])),_:1}),n(r,{align:"center"},{default:i((()=>[p(c(K.value[1]),1)])),_:1})])),_:1}),n(y,null,{default:i((()=>[n(g,{align:"center"},{default:i((()=>[p(c(X.value[0]),1)])),_:1}),n(g,{align:"center"},{default:i((()=>[p(c(X.value[1]),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["title"]),n(a,{title:"附件"},{value:i((()=>[u("div",null,[(t(!0),o(v,null,m(M.value.file,((e,l)=>(t(),o("div",{class:"w-[400rpx]",key:l},[u("div",{style:{color:"rgb(41, 121, 255)","text-decoration":"underline"},onClick:l=>function(e){if(e.id)"notInDingTalk"===H.env.platform?A({id:e.id}).then((l=>{let a="blob";".png"!==e.fileType&&".jpg"!==e.fileType&&".jpeg"!==e.fileType||(a="arraybuffer");const t=new Blob([l],{type:a}),o=URL.createObjectURL(t),n=document.createElement("a");n.style.display="none",n.href=o,n.setAttribute("download",`${e.orName}${e.fileType}`),document.body.appendChild(n),console.log(n,"link"),n.click(),document.body.removeChild(n)})).catch((e=>{console.error("请求失败:",e)})):D("1",e.id,e.fileType,e.orName);else if("notInDingTalk"===H.env.platform){const{fileName:l,path:a}=e;E(l,a).then((e=>{console.log(e,"res1");const a=document.createElement("a");a.download=l,a.style.display="none";const t=new Blob([e],{type:e.type});a.href=URL.createObjectURL(t),document.body.appendChild(a),a.click(),document.body.removeChild(a)})).catch((e=>{this.$message.error("下载异常请联系管理员")}))}else D("2",e.fileName,e.path)}(e)},c(e.orName),9,["onClick"])])))),128))])])),_:1}),n(P,{history:Z.value.history},null,8,["history"])])),_:1})):s("",!0)])),_:1}),u("div",{class:"orderinfo_footer flex"},[5==Z.value.state&&Z.value.isResponse||6==Z.value.state&&Z.value.isResponse||2==Z.value.state&&Z.value.isResponse?(t(),o("div",{key:0,class:"footer_btn",onClick:ue},[n(U,{type:"primary",size:"small",text:"反馈"})])):s("",!0),1===Z.value.state&&Z.value.isResponse?(t(),o("div",{key:1,class:"footer_btn",onClick:fe},[n(U,{type:"primary",size:"small",text:"签收"})])):s("",!0),Z.value.isExamine?(t(),o("div",{key:2,class:"footer_btn",onClick:be},[n(U,{type:"warning",size:"small",text:"审核"})])):s("",!0)]),n(W,{ref_key:"transferPopupRef",ref:ie,type:"dialog"},{default:i((()=>[n(Q,{mode:"input",title:"反馈","before-close":!0,onClose:pe,onConfirm:ve},{default:i((()=>[n(G,{labelPosition:"left",model:f(oe),rules:ne.value,labelWidth:"50px",ref_key:"TransferFormRef",ref:te},{default:i((()=>[n(z,{label:"内容",prop:"content",borderBottom:"",required:""},{default:i((()=>[n($,{placeholder:"请输入内容",border:"surround",modelValue:f(oe).content,"onUpdate:modelValue":l[0]||(l[0]=e=>f(oe).content=e)},null,8,["modelValue"])])),_:1}),n(z,{label:"上传",prop:"fileList",borderBottom:""},{default:i((()=>[n(J,{fileList:se.value,onAfterRead:re,onDelete:de,name:"1",multiple:"",maxCount:10,previewFullImage:!0,accept:"file,image"},null,8,["fileList"])])),_:1}),(t(!0),o(v,null,m(f(oe).inputFields,((e,l)=>(t(),d(z,{required:"",key:l,label:e.name,prop:"inputFields["+l+"].value",borderBottom:""},{default:i((()=>[n($,{placeholder:"请输入内容",border:"surround",modelValue:e.value,"onUpdate:modelValue":l=>e.value=l},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label","prop"])))),128))])),_:1},8,["model","rules"])])),_:1})])),_:1},512),n(W,{ref_key:"delegatePopupRef",ref:me,type:"dialog"},{default:i((()=>[n(Q,{title:"签收","before-close":!0,onClose:ye,onConfirm:ge})])),_:1},512)])}}},[["__scopeId","data-v-ee46baeb"]]);export{M as default};
