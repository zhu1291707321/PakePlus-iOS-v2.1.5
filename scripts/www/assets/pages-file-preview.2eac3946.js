import{v as e,x as r,y as i,z as t,o as s,n as o,w as l,i as a,b as n,e as c,d,f as h,A as u}from"./index-634fa69d.js";import{_ as w}from"./u-navbar.5a6ebb76.js";import{r as f}from"./uni-app.es.78f2cdc8.js";import{a as g}from"./common.c1fe3543.js";import{_ as m}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-icon.57682e04.js";import"./request.87fc902a.js";const M=m({data:()=>({buildPreviewUrl:"https://134.161.12.151:7777/onlinePreview?url=aHR0cDovLzEwLjEwLjEwMC40Mjo5MDAwL3Nzb20tc29jLzIwMjUvMTEvMDQvMjYxXzE3NjIyMjQ0NDk1MzgueGxzeD9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPWFkbWluJTJGMjAyNTExMDUlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUxMTA1VDA0MDgyOVomWC1BbXotRXhwaXJlcz0zNjAwJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZYLUFtei1TaWduYXR1cmU9MjA4ZTc0YzFiOTcxMGRlNzRmNWU3MmE4ZWE2NWMwNTJmZTFmNmZhODE4YjJkOTM4M2MxNjgyMTcwZjcyYjU3NA==&officePreviewType=html",fileId:null,loading:!1,error:!1,errorMessage:"",showWebView:!1}),onLoad(r){console.log("onLoad options:",r),r&&r.fileId?(this.fileId=r.fileId,console.log("获取到fileId:",this.fileId),this.getPreviewUrl()):(console.error("未获取到fileId参数"),this.error=!0,this.errorMessage="缺少文件ID参数",e())},methods:{getPreviewUrlIOS(){try{window.webkit.messageHandlers.openUrl.postMessage({type:6,urlStr:this.buildPreviewUrl})}catch(e){uni.$u.toast("您可能使用的不是IOS系统")}},getPreviewUrlAndroid(){try{window.AndroidH5.openUrl("6",this.buildPreviewUrl)}catch(e){uni.$u.toast("您可能使用的不是安卓系统")}},handleMessage(e){console.log("接收到的消息："+JSON.stringify(e.detail.data))},rightClick(){try{this.$router.resolve({path:this.buildPreviewUrl}).href;window.open(this.buildPreviewUrl,"_blank")}catch(e){r({data:this.buildPreviewUrl,success:function(){i({title:"已复制网址",duration:2e3})}})}},leftClick(){console.log("leftClick")},async getPreviewUrl(){if(!this.fileId)return console.error("fileId为空，无法获取预览URL"),this.error=!0,this.errorMessage="文件ID为空，请检查参数",void e();this.loading=!0,this.error=!1;try{const e=new Promise(((e,r)=>{setTimeout((()=>r(new Error("请求超时"))),1e4)})),r=g(this.fileId),i=await Promise.race([r,e]);this.buildPreviewUrl=i}catch(r){console.error("获取预览URL失败:",r),this.error=!0,"请求超时"===r.message?this.errorMessage="请求超时，请检查网络后重试":this.errorMessage="加载失败，请重试",i({title:this.errorMessage,icon:"none",duration:3e3})}finally{this.loading=!1,e()}},BackPress(){t({delta:1})}}},[["render",function(e,r,i,t,g,m){const M=f(d("up-navbar"),w),p=a,v=h,U=u;return s(),o(p,{class:"preview-container"},{default:l((()=>[n(M,{leftText:"返回",rightText:"复制预览链接",title:"文件预览",onRightClick:m.rightClick,autoBack:!0},null,8,["onRightClick"]),n(p,{class:"status-bar"}),n(p,{class:"content-area"},{default:l((()=>[n(p,{class:"error-container"},{default:l((()=>[n(v,{class:"error-text"},{default:l((()=>[c("当前页面未出现预览， 请点击以下对应按钮将自动打开浏览器， 如果当前不是用办公APP复制右上角链接打开浏览器预览")])),_:1}),n(U,{type:"primary",onClick:m.getPreviewUrlIOS,class:"retry-btn"},{default:l((()=>[c("IOS预览")])),_:1},8,["onClick"]),n(U,{type:"primary",style:{"margin-top":"10rpx"},onClick:m.getPreviewUrlAndroid,class:"retry-btn"},{default:l((()=>[c("安卓预览")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-714fa5bd"]]);export{M as default};
