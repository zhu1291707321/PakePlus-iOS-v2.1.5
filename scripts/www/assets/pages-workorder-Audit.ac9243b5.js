import{O as e,P as t,Q as a,a0 as n,R as o,S as l,ab as i,o as r,n as s,w as u,b as d,L as c,e as h,t as f,E as p,K as m,ac as g,f as y,i as b,D as x,N as v,r as C,c as _,a as S,p as j,ad as w,z as B,F as V,m as k,q as $,d as F}from"./index-634fa69d.js";import{_ as I}from"./u-input.0deae26b.js";import{a as N,r as E}from"./uni-app.es.78f2cdc8.js";import{_ as P}from"./u-button.3f55f15e.js";import{a as K,b as D,c as T,d as H}from"./uni-table.0af46610.js";import{_ as L,a as O}from"./uni-popup.9671773e.js";import{_ as R}from"./_plugin-vue_export-helper.1b428a4d.js";import{l as U,k as q,m as z,c as A}from"./workorder.a3c585f7.js";import{d as G}from"./index.e8efd85e.js";import"./u-icon.57682e04.js";import"./u-loading-icon.09a3efa7.js";import"./uni-icons.34e2de6b.js";import"./request.87fc902a.js";const J=R({name:"u-textarea",mixins:[t,a,{props:{value:{type:[String,Number],default:()=>e.textarea.value},modelValue:{type:[String,Number],default:()=>e.textarea.value},placeholder:{type:[String,Number],default:()=>e.textarea.placeholder},placeholderClass:{type:String,default:()=>e.input.placeholderClass},placeholderStyle:{type:[String,Object],default:()=>e.input.placeholderStyle},height:{type:[String,Number],default:()=>e.textarea.height},confirmType:{type:String,default:()=>e.textarea.confirmType},disabled:{type:Boolean,default:()=>e.textarea.disabled},count:{type:Boolean,default:()=>e.textarea.count},focus:{type:Boolean,default:()=>e.textarea.focus},autoHeight:{type:Boolean,default:()=>e.textarea.autoHeight},fixed:{type:Boolean,default:()=>e.textarea.fixed},cursorSpacing:{type:Number,default:()=>e.textarea.cursorSpacing},cursor:{type:[String,Number],default:()=>e.textarea.cursor},showConfirmBar:{type:Boolean,default:()=>e.textarea.showConfirmBar},selectionStart:{type:Number,default:()=>e.textarea.selectionStart},selectionEnd:{type:Number,default:()=>e.textarea.selectionEnd},adjustPosition:{type:Boolean,default:()=>e.textarea.adjustPosition},disableDefaultPadding:{type:Boolean,default:()=>e.textarea.disableDefaultPadding},holdKeyboard:{type:Boolean,default:()=>e.textarea.holdKeyboard},maxlength:{type:[String,Number],default:()=>e.textarea.maxlength},border:{type:String,default:()=>e.textarea.border},formatter:{type:[Function,null],default:()=>e.textarea.formatter},ignoreCompositionEvent:{type:Boolean,default:!0}}}],data:()=>({innerValue:"",focused:!1,firstChange:!0,changeFromInner:!1,innerFormatter:e=>e}),created(){},watch:{modelValue:{immediate:!0,handler(e,t){this.innerValue=e,!1===this.firstChange&&!1===this.changeFromInner&&this.valueChange(),this.firstChange=!1,this.changeFromInner=!1}}},computed:{textareaClass(){let e=[],{border:t,disabled:a}=this;return"surround"===t&&(e=e.concat(["u-border","u-textarea--radius"])),"bottom"===t&&(e=e.concat(["u-border-bottom","u-textarea--no-radius"])),a&&e.push("u-textarea--disabled"),e.join(" ")},textareaStyle(){return n({},o(this.customStyle))}},emits:["update:modelValue","linechange","focus","blur","change","confirm","keyboardheightchange"],methods:{addStyle:o,addUnit:l,setFormatter(e){this.innerFormatter=e},onFocus(e){this.$emit("focus",e)},onBlur(e){this.$emit("blur",e),i(this,"blur")},onLinechange(e){this.$emit("linechange",e)},onInput(e){let{value:t=""}=e.detail||{};const a=(this.formatter||this.innerFormatter)(t);this.innerValue=t,this.$nextTick((()=>{this.innerValue=a,this.valueChange()}))},valueChange(){const e=this.innerValue;this.$nextTick((()=>{this.$emit("update:modelValue",e),this.changeFromInner=!0,this.$emit("change",e),i(this,"change")}))},onConfirm(e){this.$emit("confirm",e)},onKeyboardheightchange(e){this.$emit("keyboardheightchange",e)}}},[["render",function(e,t,a,n,o,l){const i=g,x=y,v=b;return r(),s(v,{class:m(["u-textarea",l.textareaClass]),style:c([l.textareaStyle])},{default:u((()=>[d(i,{class:"u-textarea__field",value:o.innerValue,style:c({height:l.addUnit(e.height)}),placeholder:e.placeholder,"placeholder-style":l.addStyle(e.placeholderStyle,"string"),"placeholder-class":e.placeholderClass,disabled:e.disabled,focus:e.focus,autoHeight:e.autoHeight,fixed:e.fixed,cursorSpacing:e.cursorSpacing,cursor:e.cursor,showConfirmBar:e.showConfirmBar,selectionStart:e.selectionStart,selectionEnd:e.selectionEnd,adjustPosition:e.adjustPosition,disableDefaultPadding:e.disableDefaultPadding,holdKeyboard:e.holdKeyboard,maxlength:e.maxlength,"confirm-type":e.confirmType,ignoreCompositionEvent:e.ignoreCompositionEvent,onFocus:l.onFocus,onBlur:l.onBlur,onLinechange:l.onLinechange,onInput:l.onInput,onConfirm:l.onConfirm,onKeyboardheightchange:l.onKeyboardheightchange},null,8,["value","style","placeholder","placeholder-style","placeholder-class","disabled","focus","autoHeight","fixed","cursorSpacing","cursor","showConfirmBar","selectionStart","selectionEnd","adjustPosition","disableDefaultPadding","holdKeyboard","maxlength","confirm-type","ignoreCompositionEvent","onFocus","onBlur","onLinechange","onInput","onConfirm","onKeyboardheightchange"]),e.count?(r(),s(x,{key:0,class:"u-textarea__count",style:c({"background-color":e.disabled?"transparent":"#fff"})},{default:u((()=>[h(f(o.innerValue.length)+"/"+f(e.maxlength),1)])),_:1},8,["style"])):p("",!0)])),_:1},8,["class","style"])}],["__scopeId","data-v-56565a8a"]]),M=R({__name:"Audit",setup(e){"notInDingTalk"!==G.env.platform&&G.biz.navigation.setTitle({title:"工单审核"}),N((e=>{a.value=e.id,p(e.id)}));const t=x({id:"",ids:"",handleCompleteContent:"",rejectContent:"",tableData:[],loading:!1}),{id:a,ids:n,handleCompleteContent:o,rejectContent:l,tableData:i,loading:c}=v(t);async function p(e){c.value=!0;const{data:t}=await U(e),a=[];for(const n of t.history)if(6==n.state&&n.reviewContent)for(let e of n.reviewContent)"RESPONSE"==e.type&&(e.id=n.id,e.deptName=n.deptName,a.push(e));i.value=a,c.value=!1,console.log(a,"listlist")}function m(){B({delta:1})}function g(e){const t=e.detail.index;n.value=t.map((e=>i.value[e].id))}const y=C(null);function b(){""===o.value?uni.$u.toast("请输入审核内容"):0===n.value.length?uni.$u.toast("请选择数据"):y.value.open("center")}const R=C();function M(){y.value.close()}async function Q(){try{const{data:e}=await q({handleCompleteContent:o.value,ids:n.value,orderId:a.value});M(),uni.$u.toast("操作成功"),$({url:"/pages/workorder/OrderInfo?id="+a.value}),async function(e){const{data:t}=await A(e);R.value=t}(a),p(a)}catch(e){return msg}console.log("data111",o)}const W=C(null);function X(){0===n.value.length?uni.$u.toast("请选择数据"):W.value.open("center")}function Y(){W.value.close()}async function Z(){if(!l.value)return uni.$u.toast("请输入驳回原因");try{const{data:e}=await z({handleCompleteContent:l.value,ids:n.value,orderId:a.value});Y(),uni.$u.toast("操作成功")}catch(e){}}return(e,t)=>{const a=E(F("up-input"),I),n=E(F("up-button"),P),p=E(F("uni-th"),K),x=E(F("uni-tr"),D),v=E(F("uni-td"),T),C=E(F("uni-table"),H),B=E(F("uni-popup-dialog"),L),$=E(F("uni-popup"),O),N=E(F("up-textarea"),J);return r(),_("div",{class:"audit"},[S("div",{class:"audit_content"},[d(a,{placeholder:"请输入审核内容",border:"surround",modelValue:j(o),"onUpdate:modelValue":t[0]||(t[0]=e=>w(o)?o.value=e:null)},null,8,["modelValue"])]),S("div",{class:"audit_btn_row"},[S("div",{class:"audit_btn",onClick:b},[d(n,{type:"primary",text:"确定"})]),S("div",{class:"audit_btn",onClick:X},[d(n,{type:"error",text:"驳回"})]),S("div",{class:"audit_btn",onClick:m},[d(n,{type:"error",text:"返回"})])]),d(C,{ref:"table",loading:j(c),border:"",stripe:"",type:"selection",emptyText:"暂无更多数据",onSelectionChange:g},{default:u((()=>[d(x,null,{default:u((()=>[d(p,{width:"200",align:"left"},{default:u((()=>[h("操作日期")])),_:1}),d(p,{width:"100",align:"left"},{default:u((()=>[h("城市")])),_:1}),d(p,{width:"100",align:"left"},{default:u((()=>[h("操作人")])),_:1}),d(p,{align:"left"},{default:u((()=>[h("反馈内容")])),_:1})])),_:1}),(r(!0),_(V,null,k(j(i),((e,t)=>(r(),s(x,{key:t},{default:u((()=>[d(v,null,{default:u((()=>[h(f(e.createTime),1)])),_:2},1024),d(v,null,{default:u((()=>[h(f(e.deptName),1)])),_:2},1024),d(v,null,{default:u((()=>[h(f(e.name),1)])),_:2},1024),d(v,null,{default:u((()=>[h(f(e.fullMessage),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["loading"]),d($,{ref_key:"auditRef",ref:y,type:"dialog"},{default:u((()=>[d(B,{title:"审核通过","before-close":!0,onClose:M,onConfirm:Q})])),_:1},512),d($,{ref_key:"rejectRef",ref:W,type:"dialog"},{default:u((()=>[d(B,{title:"驳回","before-close":!0,onClose:Y,onConfirm:Z},{default:u((()=>[h(" 原因： "),d(N,{modelValue:j(l),"onUpdate:modelValue":t[1]||(t[1]=e=>w(l)?l.value=e:null),autoHeight:"",placeholder:"请输入驳回原因"},null,8,["modelValue"])])),_:1})])),_:1},512)])}}},[["__scopeId","data-v-a8dacc90"]]);export{M as default};
