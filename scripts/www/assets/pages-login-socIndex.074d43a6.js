import{v as e,r as a,D as l,N as s,o,c as t,a as r,K as u,p as n,b as i,w as d,B as c,F as p,e as m,t as f,C as g,s as v,d as b}from"./index-634fa69d.js";import{_ as h}from"./u-input.0deae26b.js";import{o as _,r as y}from"./uni-app.es.78f2cdc8.js";import{_ as k,a as V}from"./u-form.9aed71e3.js";import{_ as x}from"./u-button.3f55f15e.js";import{a as C,s as j,l as w,b as I}from"./login.e0b6d30e.js";import{d as $}from"./index.e8efd85e.js";import{_ as q}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-icon.57682e04.js";import"./u-line.68a19bb8.js";import"./u-loading-icon.09a3efa7.js";import"./request.87fc902a.js";const U=q({__name:"socIndex",setup(q){function U(){c({url:"/pages/login/index"})}_((()=>{"notInDingTalk"!==$.env.platform&&$.biz.navigation.setTitle({title:"登录"}),setTimeout((()=>{e()}),2e3)}));const W=a("");function T(){C().then((e=>{W.value=e.data.img,D.value.uuid=e.data.uuid}))}T();const z=a(!1),A=a(0),B=l({userInfo:{username:"",password:"",code:"",uuid:"",phone:"",smsCode:""},rules:{username:{type:"string",required:!0,message:"请填写用户名",trigger:["blur"]},password:{type:"string",required:!0,message:"请填写密码",trigger:["blur"]},code:{type:"string",required:!0,message:"请填写验证码",trigger:["blur"]},phone:{type:"string",required:!0,message:"请填写手机号",trigger:["blur"],validator:(e,a)=>/^1[3-9]\d{9}$/.test(a)},smsCode:{type:"string",required:!0,message:"请填写短信验证码",trigger:["blur"]}}}),{userInfo:D,rules:O}=s(B),E=a(null);function F(){E.value.validate().then((a=>{a?async function(){try{let e;g({title:"登录中...",mask:!0}),e=z.value?await w({phonenumber:D.value.phone,smsCode:D.value.smsCode}):await I(D.value);const{data:a,code:l,msg:s}=e;200===l?(v("token",a.token),v("user",a.user),c({url:"/pages/home/index"})):uni.$u.toast(s)}catch(a){z.value||(D.value.code="",T()),uni.$u.toast(a.msg)}finally{e()}}():uni.$u.toast("请填写登录信息")})).catch((()=>{uni.$u.toast("请填写登录信息")}))}function G(e){z.value=e,Object.keys(D.value).forEach((e=>{D.value[e]=""}))}async function H(){try{if(!/^1[3-9]\d{9}$/.test(D.value.phone))return void uni.$u.toast("请输入正确的手机号");g({title:"发送中...",mask:!0});const e=await j(D.value.phone);if(200===e.code){uni.$u.toast("验证码已发送"),A.value=60;const e=setInterval((()=>{A.value--,A.value<=0&&clearInterval(e)}),1e3)}else uni.$u.toast(e.msg)}catch(a){uni.$u.toast(a.msg||"发送失败")}finally{e()}}return(e,a)=>{const l=y(b("up-input"),h),s=y(b("up-form-item"),k),c=y(b("up-button"),x),g=y(b("up-form"),V);return o(),t("div",{class:"login-container"},[r("div",{class:"login-header"},[r("h1",null,"欢迎登录")]),r("div",{class:"login-card"},[r("div",{class:"login-tabs"},[r("div",{class:u(["tab-item",{active:!n(z)}]),onClick:a[0]||(a[0]=e=>G(!1))}," 账号登录 ",2),r("div",{class:u(["tab-item",{active:n(z)}]),onClick:a[1]||(a[1]=e=>G(!0))}," 手机登录 ",2)]),i(g,{labelPosition:"top",model:n(D),rules:n(O),ref_key:"formRef",ref:E},{default:d((()=>[n(z)?(o(),t(p,{key:1},[i(s,{label:"手机号",prop:"phone",labelWidth:"80"},{default:d((()=>[i(l,{modelValue:n(D).phone,"onUpdate:modelValue":a[5]||(a[5]=e=>n(D).phone=e),type:"number",placeholder:"请输入手机号",prefixIcon:"phone",clearable:""},null,8,["modelValue"])])),_:1}),i(s,{label:"验证码",prop:"smsCode",labelWidth:"80"},{default:d((()=>[r("div",{class:"sms-row"},[i(l,{modelValue:n(D).smsCode,"onUpdate:modelValue":a[6]||(a[6]=e=>n(D).smsCode=e),placeholder:"请输入验证码",prefixIcon:"more-circle",clearable:""},null,8,["modelValue"]),i(c,{class:"sms-btn",onClick:H,disabled:n(A)>0},{default:d((()=>[m(f(n(A)>0?`${n(A)}s后获取`:"获取验证码"),1)])),_:1},8,["disabled"])])])),_:1})],64)):(o(),t(p,{key:0},[i(s,{label:"用户名",prop:"username",labelWidth:"80"},{default:d((()=>[i(l,{modelValue:n(D).username,"onUpdate:modelValue":a[2]||(a[2]=e=>n(D).username=e),placeholder:"请输入用户名",prefixIcon:"account",clearable:""},null,8,["modelValue"])])),_:1}),i(s,{label:"密码",prop:"password",labelWidth:"80"},{default:d((()=>[i(l,{modelValue:n(D).password,"onUpdate:modelValue":a[3]||(a[3]=e=>n(D).password=e),password:"",placeholder:"请输入密码",prefixIcon:"lock",clearable:""},null,8,["modelValue"])])),_:1}),i(s,{label:"验证码",prop:"code",labelWidth:"80"},{default:d((()=>[r("div",{class:"captcha-row"},[i(l,{modelValue:n(D).code,"onUpdate:modelValue":a[4]||(a[4]=e=>n(D).code=e),placeholder:"请输入验证码",prefixIcon:"edit-pen",clearable:""},null,8,["modelValue"]),r("img",{class:"captcha-img",src:"data:image/png;base64,"+n(W),onClick:T},null,8,["src"])])])),_:1})],64)),i(c,{class:"login-btn",onClick:F,shape:"circle"},{default:d((()=>[m(" 登 录 ")])),_:1})])),_:1},8,["model","rules"]),r("div",{class:"login-footer"},[i(c,{class:"login-btn",type:"text",onClick:U},{default:d((()=>[m(" 联通OA登录 ")])),_:1})])])])}}},[["__scopeId","data-v-9d565286"]]);export{U as default};
