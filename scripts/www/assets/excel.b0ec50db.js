import{an as e,al as t,ak as a,O as s,P as i,Q as l,S as o,R as u,a2 as d,a9 as n,aA as r,d as p,o as c,n as m,w as f,b as h,c as g,F as y,m as _,L as b,e as w,t as k,E as v,V as x,U as j,K as z,a7 as I,f as C,i as F,J as S}from"./index-634fa69d.js";import{_ as R}from"./u-icon.57682e04.js";import{r as $}from"./uni-app.es.78f2cdc8.js";import{_ as O}from"./u-loading-icon.09a3efa7.js";import{_ as T}from"./_plugin-vue_export-helper.1b428a4d.js";import"./FileSaver.min.c18a2d77.js";import{d as B}from"./index.e8efd85e.js";function D(e,t){return["[object Object]","[object File]"].includes(Object.prototype.toString.call(e))?Object.keys(e).reduce(((a,s)=>(t.includes(s)||(a[s]=e[s]),a)),{}):{}}function P(e){return e.tempFiles.map((e=>({...D(e,["path"]),url:e.path,size:e.size,name:e.name,type:e.type})))}function L({accept:s,multiple:i,capture:l,compressed:o,maxDuration:u,sizeType:d,camera:n,maxCount:r}){return new Promise(((p,c)=>{switch(s){case"image":a({count:i?Math.min(r,9):1,sourceType:l,sizeType:d,success:e=>p(function(e){return e.tempFiles.map((e=>({...D(e,["path"]),type:"image",url:e.path,thumb:e.path,size:e.size,name:e.name})))}(e)),fail:c});break;case"video":t({sourceType:l,compressed:o,maxDuration:u,camera:n,success:e=>p(function(e){return[{...D(e,["tempFilePath","thumbTempFilePath","errMsg"]),type:"video",url:e.tempFilePath,thumb:e.thumbTempFilePath,size:e.size,name:e.name}]}(e)),fail:c});break;case"file":e({count:i?r:1,type:s,success:e=>p(P(e)),fail:c});break;default:e({count:i?r:1,type:"all",success:e=>p(P(e)),fail:c})}}))}const A=T({name:"u-upload",mixins:[i,l,{watch:{accept:{immediate:!0,handler(e){}}}},{props:{accept:{type:String,default:()=>s.upload.accept},capture:{type:[String,Array],default:()=>s.upload.capture},compressed:{type:Boolean,default:()=>s.upload.compressed},camera:{type:String,default:()=>s.upload.camera},maxDuration:{type:Number,default:()=>s.upload.maxDuration},uploadIcon:{type:String,default:()=>s.upload.uploadIcon},uploadIconColor:{type:String,default:()=>s.upload.uploadIconColor},useBeforeRead:{type:Boolean,default:()=>s.upload.useBeforeRead},afterRead:{type:Function,default:null},beforeRead:{type:Function,default:null},previewFullImage:{type:Boolean,default:()=>s.upload.previewFullImage},maxCount:{type:[String,Number],default:()=>s.upload.maxCount},disabled:{type:Boolean,default:()=>s.upload.disabled},imageMode:{type:String,default:()=>s.upload.imageMode},name:{type:String,default:()=>s.upload.name},sizeType:{type:Array,default:()=>s.upload.sizeType},multiple:{type:Boolean,default:()=>s.upload.multiple},deletable:{type:Boolean,default:()=>s.upload.deletable},maxSize:{type:[String,Number],default:()=>s.upload.maxSize},fileList:{type:Array,default:()=>s.upload.fileList},uploadText:{type:String,default:()=>s.upload.uploadText},width:{type:[String,Number],default:()=>s.upload.width},height:{type:[String,Number],default:()=>s.upload.height},previewImage:{type:Boolean,default:()=>s.upload.previewImage}}}],data:()=>({lists:[],isInCount:!0}),watch:{fileList:{handler(){this.formatFileList()},immediate:!0,deep:!0}},emits:["error","beforeRead","oversize","afterRead","delete","clickPreview"],methods:{addUnit:o,addStyle:u,formatFileList(){const{fileList:e=[],maxCount:t}=this,a=e.map((e=>Object.assign(Object.assign({},e),{isImage:"image"===this.accept||d.image(e.url||e.thumb),isVideo:"video"===this.accept||d.video(e.url||e.thumb),deletable:"boolean"==typeof e.deletable?e.deletable:this.deletable})));this.lists=a,this.isInCount=a.length<t},chooseFile(){const{maxCount:e,multiple:t,lists:a,disabled:s}=this;if(s)return;let i;try{i=d.array(this.capture)?this.capture:this.capture.split(",")}catch(l){i=[]}L(Object.assign({accept:this.accept,multiple:this.multiple,capture:i,compressed:this.compressed,maxDuration:this.maxDuration,sizeType:this.sizeType,camera:this.camera},{maxCount:e-a.length})).then((e=>{this.onBeforeRead(t?e:e[0])})).catch((e=>{this.$emit("error",e)}))},onBeforeRead(e){const{beforeRead:t,useBeforeRead:a}=this;let s=!0;d.func(t)&&(s=t(e,this.getDetail())),a&&(s=new Promise(((t,a)=>{this.$emit("beforeRead",Object.assign(Object.assign({file:e},this.getDetail()),{callback:e=>{e?t():a()}}))}))),s&&(d.promise(s)?s.then((t=>this.onAfterRead(t||e))):this.onAfterRead(e))},getDetail(e){return{name:this.name,index:null==e?this.fileList.length:e}},onAfterRead(e){const{maxSize:t,afterRead:a}=this;(Array.isArray(e)?e.some((e=>e.size>t)):e.size>t)?this.$emit("oversize",Object.assign({file:e},this.getDetail())):("function"==typeof a&&a(e,this.getDetail()),this.$emit("afterRead",Object.assign({file:e},this.getDetail())))},deleteItem(e){this.$emit("delete",Object.assign(Object.assign({},this.getDetail(e)),{file:this.fileList[e]}))},onPreviewImage(e){e.isImage&&this.previewFullImage&&n({urls:this.lists.filter((e=>"image"===this.accept||d.image(e.url||e.thumb))).map((e=>e.url||e.thumb)),current:e.url||e.thumb,fail(){r("预览图片失败")}})},onPreviewVideo(e){if(!this.data.previewFullImage)return;const{index:t}=e.currentTarget.dataset,{lists:a}=this.data;wx.previewMedia({sources:a.filter((e=>isVideoFile(e))).map((e=>Object.assign(Object.assign({},e),{type:"video"}))),current:t,fail(){r("预览视频失败")}})},onClickPreview(e){const{index:t}=e.currentTarget.dataset,a=this.data.lists[t];this.$emit("clickPreview",Object.assign(Object.assign({},a),this.getDetail(t)))}}},[["render",function(e,t,a,s,i,l){const o=I,u=$(p("u-icon"),R),d=C,n=F,r=$(p("u-loading-icon"),O);return c(),m(n,{class:"u-upload",style:b([l.addStyle(e.customStyle)])},{default:f((()=>[h(n,{class:"u-upload__wrap"},{default:f((()=>[e.previewImage?(c(!0),g(y,{key:0},_(i.lists,((t,a)=>(c(),m(n,{class:"u-upload__wrap__preview",key:a},{default:f((()=>[t.isImage||t.type&&"image"===t.type?(c(),m(o,{key:0,src:t.thumb||t.url,mode:e.imageMode,class:"u-upload__wrap__preview__image",onClick:e=>l.onPreviewImage(t),style:b([{width:l.addUnit(e.width),height:l.addUnit(e.height)}])},null,8,["src","mode","onClick","style"])):(c(),m(n,{key:1,class:"u-upload__wrap__preview__other"},{default:f((()=>[h(u,{color:"#80CBF9",size:"26",name:t.isVideo||t.type&&"video"===t.type?"movie":"folder"},null,8,["name"]),h(d,{class:"u-upload__wrap__preview__other__text"},{default:f((()=>[w(k(t.isVideo||t.type&&"video"===t.type?"视频":"文件"),1)])),_:2},1024)])),_:2},1024)),"uploading"===t.status||"failed"===t.status?(c(),m(n,{key:2,class:"u-upload__status"},{default:f((()=>[h(n,{class:"u-upload__status__icon"},{default:f((()=>["failed"===t.status?(c(),m(u,{key:0,name:"close-circle",color:"#ffffff",size:"25"})):(c(),m(r,{key:1,size:"22",mode:"circle",color:"#ffffff"}))])),_:2},1024),t.message?(c(),m(d,{key:0,class:"u-upload__status__message"},{default:f((()=>[w(k(t.message),1)])),_:2},1024)):v("",!0)])),_:2},1024)):v("",!0),"uploading"!==t.status&&(e.deletable||t.deletable)?(c(),m(n,{key:3,class:"u-upload__deletable",onClick:x((e=>l.deleteItem(a)),["stop"])},{default:f((()=>[h(n,{class:"u-upload__deletable__icon"},{default:f((()=>[h(u,{name:"close",color:"#ffffff",size:"10"})])),_:1})])),_:2},1032,["onClick"])):v("",!0),"success"===t.status?(c(),m(n,{key:4,class:"u-upload__success"},{default:f((()=>[h(n,{class:"u-upload__success__icon"},{default:f((()=>[h(u,{name:"checkmark",color:"#ffffff",size:"12"})])),_:1})])),_:1})):v("",!0)])),_:2},1024)))),128)):v("",!0),i.isInCount?(c(),g(y,{key:1},[e.$slots.default||e.$slots.$default?(c(),m(n,{key:0,onClick:l.chooseFile},{default:f((()=>[j(e.$slots,"default",{},void 0,!0)])),_:3},8,["onClick"])):(c(),m(n,{key:1,class:z(["u-upload__button",[e.disabled&&"u-upload__button--disabled"]]),"hover-class":e.disabled?"":"u-upload__button--hover","hover-stay-time":"150",onClick:l.chooseFile,style:b([{width:l.addUnit(e.width),height:l.addUnit(e.height)}])},{default:f((()=>[h(u,{name:e.uploadIcon,size:"26",color:e.uploadIconColor},null,8,["name","color"]),e.uploadText?(c(),m(d,{key:0,class:"u-upload__button__text"},{default:f((()=>[w(k(e.uploadText),1)])),_:1})):v("",!0)])),_:1},8,["hover-class","onClick","class","style"]))],64)):v("",!0)])),_:3})])),_:3},8,["style"])}],["__scopeId","data-v-259154e3"]]),U=(e,t,a,s)=>{let i=`https://58.20.99.151:9000/#/pages/file/download?token=${S("token")}&type=${e}&param1=${t}&param2=${a}&param3=${s}`,l=`dingtalk://dingtalkclient/action/jump?url=${encodeURIComponent(i)}`;window.open(i),B.openLink({url:l,success:()=>{},fail:()=>{},complete:()=>{}})},M=(e,t)=>{let a=`https://58.20.99.151:9000/#/pages/group/download?url=${e}&name=${t}`,s=`dingtalk://dingtalkclient/action/jump?url=${encodeURIComponent(a)}`;window.open(a),B.openLink({url:s,success:()=>{},fail:()=>{},complete:()=>{}})};export{A as _,M as a,U as o};
