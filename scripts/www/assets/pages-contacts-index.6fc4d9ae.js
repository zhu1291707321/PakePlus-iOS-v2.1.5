import{O as e,P as t,Q as o,a2 as a,S as l,d as i,o as n,n as c,w as s,U as r,b as d,E as u,c as m,F as p,m as y,L as f,e as h,t as _,i as b,f as g,a3 as k,a4 as S,Y as P,a5 as w,R as E,D as x,r as v,J as C,k as V,y as B,K as N,B as z,I as L,A as I,a6 as T}from"./index-634fa69d.js";import{_ as $}from"./u-icon.57682e04.js";import{r as O,o as j,a as q}from"./uni-app.es.78f2cdc8.js";import{_ as U}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as D}from"./uni-data-select.66b35b24.js";import{d as A}from"./index.e8efd85e.js";import{r as H}from"./request.87fc902a.js";import{e as R,u as G}from"./common.c1fe3543.js";import"./uni-icons.34e2de6b.js";const F=U({mixins:[t,o,{props:{text:{type:[Array],default:()=>e.columnNotice.text},icon:{type:String,default:()=>e.columnNotice.icon},mode:{type:String,default:()=>e.columnNotice.mode},color:{type:String,default:()=>e.columnNotice.color},bgColor:{type:String,default:()=>e.columnNotice.bgColor},fontSize:{type:[String,Number],default:()=>e.columnNotice.fontSize},speed:{type:[String,Number],default:()=>e.columnNotice.speed},step:{type:Boolean,default:()=>e.columnNotice.step},duration:{type:[String,Number],default:()=>e.columnNotice.duration},disableTouch:{type:Boolean,default:()=>e.columnNotice.disableTouch}}}],watch:{text:{immediate:!0,handler(e,t){a.array(e)}}},computed:{textStyle(){let e={};return e.color=this.color,e.fontSize=l(this.fontSize),e},vertical(){return"horizontal"!=this.mode}},data:()=>({index:0}),emits:["click","close"],methods:{noticeChange(e){this.index=e.detail.current},clickHandler(){this.$emit("click",this.index)},close(){this.$emit("close")}}},[["render",function(e,t,o,a,l,P){const w=O(i("u-icon"),$),E=b,x=g,v=k,C=S;return n(),c(E,{class:"u-notice",onClick:P.clickHandler},{default:s((()=>[r(e.$slots,"icon",{},(()=>[e.icon?(n(),c(E,{key:0,class:"u-notice__left-icon"},{default:s((()=>[d(w,{name:e.icon,color:e.color,size:"19"},null,8,["name","color"])])),_:1})):u("",!0)]),!0),d(C,{"disable-touch":e.disableTouch,vertical:!e.step,circular:"",interval:e.duration,autoplay:!0,class:"u-notice__swiper",onChange:P.noticeChange},{default:s((()=>[(n(!0),m(p,null,y(e.text,((e,t)=>(n(),c(v,{key:t,class:"u-notice__swiper__item"},{default:s((()=>[d(x,{class:"u-notice__swiper__item__text u-line-1",style:f([P.textStyle])},{default:s((()=>[h(_(e),1)])),_:2},1032,["style"])])),_:2},1024)))),128))])),_:1},8,["disable-touch","vertical","interval","onChange"]),["link","closable"].includes(e.mode)?(n(),c(E,{key:0,class:"u-notice__right-icon"},{default:s((()=>["link"===e.mode?(n(),c(w,{key:0,name:"arrow-right",size:17,color:e.color},null,8,["color"])):u("",!0),"closable"===e.mode?(n(),c(w,{key:1,name:"close",size:16,color:e.color,onClick:P.close},null,8,["color","onClick"])):u("",!0)])),_:1})):u("",!0)])),_:3},8,["onClick"])}],["__scopeId","data-v-8f23e910"]]);const J=U({name:"u-row-notice",mixins:[t,o,{props:{text:{type:String,default:()=>e.rowNotice.text},icon:{type:String,default:()=>e.rowNotice.icon},mode:{type:String,default:()=>e.rowNotice.mode},color:{type:String,default:()=>e.rowNotice.color},bgColor:{type:String,default:()=>e.rowNotice.bgColor},fontSize:{type:[String,Number],default:()=>e.rowNotice.fontSize},speed:{type:[String,Number],default:()=>e.rowNotice.speed}}}],data:()=>({animationDuration:"0",animationPlayState:"paused",nvueInit:!0,show:!0}),watch:{text:{immediate:!0,handler(e,t){this.vue(),a.string(e)}},fontSize(){this.vue()},speed(){this.vue()}},computed:{textStyle(){let e={whiteSpace:"nowrap !important"};return e.color=this.color,e.fontSize=l(this.fontSize),e},animationStyle(){let e={};return e.animationDuration=this.animationDuration,e.animationPlayState=this.animationPlayState,e},innerText(){let e=[];const t=this.text.split("");for(let o=0;o<t.length;o+=20)e.push(t.slice(o,o+20).join(""));return e}},mounted(){this.init()},emits:["click","close"],methods:{init(){this.vue(),a.string(this.text)},async vue(){let e=0;await P(),e=(await this.$uGetRect(".u-notice__content__text")).width,(await this.$uGetRect(".u-notice__content")).width,this.animationDuration=e/w(this.speed)+"s",this.animationPlayState="paused",setTimeout((()=>{this.animationPlayState="running"}),10)},async nvue(){},loopAnimation(e,t){},getNvueRect(e){},clickHandler(e){this.$emit("click")},close(){this.$emit("close")}}},[["render",function(e,t,o,a,l,k){const S=O(i("u-icon"),$),P=b,w=g;return n(),c(P,{class:"u-notice",onClick:k.clickHandler},{default:s((()=>[r(e.$slots,"icon",{},(()=>[e.icon?(n(),c(P,{key:0,class:"u-notice__left-icon"},{default:s((()=>[d(S,{name:e.icon,color:e.color,size:"19"},null,8,["name","color"])])),_:1})):u("",!0)]),!0),d(P,{class:"u-notice__content",ref:"u-notice__content"},{default:s((()=>[d(P,{ref:"u-notice__content__text",class:"u-notice__content__text",style:f([k.animationStyle])},{default:s((()=>[(n(!0),m(p,null,y(k.innerText,((e,t)=>(n(),c(w,{key:t,style:f([k.textStyle])},{default:s((()=>[h(_(e),1)])),_:2},1032,["style"])))),128))])),_:1},8,["style"])])),_:1},512),["link","closable"].includes(e.mode)?(n(),c(P,{key:0,class:"u-notice__right-icon"},{default:s((()=>["link"===e.mode?(n(),c(S,{key:0,name:"arrow-right",size:17,color:e.color},null,8,["color"])):u("",!0),"closable"===e.mode?(n(),c(S,{key:1,onClick:k.close,name:"close",size:16,color:e.color},null,8,["onClick","color"])):u("",!0)])),_:1})):u("",!0)])),_:3},8,["onClick"])}],["__scopeId","data-v-e09af7bd"]]);const K=U({name:"u-notice-bar",mixins:[t,o,{props:{text:{type:[Array,String],default:()=>e.noticeBar.text},direction:{type:String,default:()=>e.noticeBar.direction},step:{type:Boolean,default:()=>e.noticeBar.step},icon:{type:String,default:()=>e.noticeBar.icon},mode:{type:String,default:()=>e.noticeBar.mode},color:{type:String,default:()=>e.noticeBar.color},bgColor:{type:String,default:()=>e.noticeBar.bgColor},speed:{type:[String,Number],default:()=>e.noticeBar.speed},fontSize:{type:[String,Number],default:()=>e.noticeBar.fontSize},duration:{type:[String,Number],default:()=>e.noticeBar.duration},disableTouch:{type:Boolean,default:()=>e.noticeBar.disableTouch},url:{type:String,default:()=>e.noticeBar.url},linkType:{type:String,default:()=>e.noticeBar.linkType}}}],data:()=>({show:!0}),emits:["click","close"],methods:{addStyle:E,click(e){this.$emit("click",e),this.url&&this.linkType&&this.openPage()},close(){this.show=!1,this.$emit("close")}}},[["render",function(e,t,o,a,l,r){const d=O(i("u-column-notice"),F),m=O(i("u-row-notice"),J),p=b;return l.show?(n(),c(p,{key:0,class:"u-notice-bar",style:f([{backgroundColor:e.bgColor},r.addStyle(e.customStyle)])},{default:s((()=>["column"===e.direction||"row"===e.direction&&e.step?(n(),c(d,{key:0,color:e.color,bgColor:e.bgColor,text:e.text,mode:e.mode,step:e.step,icon:e.icon,"disable-touch":e.disableTouch,fontSize:e.fontSize,duration:e.duration,onClose:r.close,onClick:r.click},null,8,["color","bgColor","text","mode","step","icon","disable-touch","fontSize","duration","onClose","onClick"])):(n(),c(m,{key:1,color:e.color,bgColor:e.bgColor,text:e.text,mode:e.mode,fontSize:e.fontSize,speed:e.speed,url:e.url,linkType:e.linkType,icon:e.icon,onClose:r.close,onClick:r.click},null,8,["color","bgColor","text","mode","fontSize","speed","url","linkType","icon","onClose","onClick"]))])),_:1},8,["style"])):u("",!0)}],["__scopeId","data-v-53928391"]]);const Q=U({__name:"index",setup(e){j((()=>{"notInDingTalk"!==A.env.platform&&A.biz.navigation.setTitle({title:"个人中心"})}));const t=x({});v({});const o=x({}),a=x({deptId:"",securityOfficer:"",securityPhone:"",securityEmail:"",deptLeader:"",deptPhone:"",deptEmail:"",companyLeader:"",companyPhone:"",companyEmail:""});q((()=>{t.value=C("user"),o.value=t.value.dept.deptId,null!=o.value&&async function(){const{data:e}=await function(e){return H({url:"/system/contacts/getDeptInfo/"+e,method:"get"})}(o.value);Object.keys(a).forEach((t=>{void 0!==e[t]&&(a[t]=e[t])})),a.id=e.id,console.log("表单数据加载完成:",a)}()}));const l=()=>{G().then((e=>{B({title:"更新通讯录成功",icon:"success"}),z({url:"/pages/user/index"})}))};const r=x({id:"",deptId:"",securityOfficer:"",securityPhone:"",securityEmail:"",deptLeader:"",deptPhone:"",deptEmail:"",companyLeader:"",companyPhone:"",companyEmail:"",company:""}),m=v([]);v(-1);const p=v(!1),y=e=>{console.log("选中的ID:",e);const t=e,o=m.value.find((e=>e.value===t));o&&(console.log("选中的ID:",t),console.log("选中的名称:",o.text),a.deptId=t,a.company=o.text,f("deptId"))},f=e=>{switch(e){case"deptId":r.deptId=a.deptId?"":"请选择单位名称";break;case"securityOfficer":r.securityOfficer=a.securityOfficer?"":"请输入网络安全专员";break;case"securityPhone":a.securityPhone?/^1[3-9]\d{9}$/.test(a.securityPhone)?r.securityPhone="":r.securityPhone="请输入正确的手机号码":r.securityPhone="请输入联系电话";break;case"securityEmail":a.securityEmail?/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(a.securityEmail)?r.securityEmail="":r.securityEmail="请输入正确的邮箱格式":r.securityEmail="请输入邮箱";break;case"deptLeader":r.deptLeader=a.deptLeader?"":"请输入部门主管领导";break;case"deptPhone":a.deptPhone?/^1[3-9]\d{9}$/.test(a.deptPhone)?r.deptPhone="":r.deptPhone="请输入正确的手机号码":r.deptPhone="请输入联系电话";break;case"deptEmail":a.deptEmail?/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(a.deptEmail)?r.deptEmail="":r.deptEmail="请输入正确的邮箱格式":r.deptEmail="请输入邮箱";break;case"companyLeader":r.companyLeader=a.companyLeader?"":"请输入分管公司领导";break;case"companyPhone":a.companyPhone?/^1[3-9]\d{9}$/.test(a.companyPhone)?r.companyPhone="":r.companyPhone="请输入正确的手机号码":r.companyPhone="请输入联系电话";break;case"companyEmail":a.companyEmail?/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(a.companyEmail)?r.companyEmail="":r.companyEmail="请输入正确的邮箱格式":r.companyEmail="请输入邮箱"}},k=async()=>{if(f("deptId"),f("securityOfficer"),f("securityPhone"),f("securityEmail"),f("deptLeader"),f("deptPhone"),f("deptEmail"),f("companyLeader"),f("companyPhone"),f("companyEmail"),Object.values(r).some((e=>e)))B({title:"请完善表单信息",icon:"none"});else{p.value=!0;try{const t=m.value.find((e=>e.value===a.deptId));a.company=t.text;const o=await(e=a,H({url:"/system/contacts",method:"put",data:e}));200==o.code?(G().then((e=>{B({title:"更新通讯录成功,请点击返回按钮",icon:"success"})})),B({title:"提交成功",icon:"success"})):B({title:o.data.message||"提交失败",icon:"none"})}catch(t){B({title:"网络错误，请重试",icon:"none"})}finally{p.value=!1}var e}};return V((()=>{(async()=>{try{const e=await R();m.value=e.data.map((e=>({text:e.deptName,value:e.deptId})))}catch(e){B({title:"获取部门列表失败",icon:"none"})}})()})),(e,t)=>{const o=O(i("up-notice-bar"),K),S=g,P=O(i("uni-data-select"),D),w=b,E=L,x=I,v=T;return n(),c(w,{class:"form-container"},{default:s((()=>[d(o,{text:"请您确认数据是否是正确的，若有变更请及时更新，没有可点击返回按钮"}),d(v,{onSubmit:k},{default:s((()=>[d(w,{class:"form-item"},{default:s((()=>[d(S,{class:"form-label"},{default:s((()=>[h("单位名称"),d(S,{class:"required"},{default:s((()=>[h("*")])),_:1})])),_:1}),d(P,{disabled:!0,modelValue:a.deptId,"onUpdate:modelValue":t[0]||(t[0]=e=>a.deptId=e),localdata:m.value,onChange:y},null,8,["modelValue","localdata"])])),_:1}),d(w,{class:"form-item"},{default:s((()=>[d(S,{class:"form-label"},{default:s((()=>[h("网络安全专员"),d(S,{class:"required"},{default:s((()=>[h("*")])),_:1})])),_:1}),d(E,{modelValue:a.securityOfficer,"onUpdate:modelValue":t[1]||(t[1]=e=>a.securityOfficer=e),placeholder:"请输入网络安全专员",class:N(["form-input",{error:r.securityOfficer}]),onBlur:t[2]||(t[2]=e=>f("securityOfficer"))},null,8,["modelValue","class"]),r.securityOfficer?(n(),c(S,{key:0,class:"error-message"},{default:s((()=>[h(_(r.securityOfficer),1)])),_:1})):u("",!0)])),_:1}),d(w,{class:"form-item"},{default:s((()=>[d(S,{class:"form-label"},{default:s((()=>[h("网络安全专员联系电话"),d(S,{class:"required"},{default:s((()=>[h("*")])),_:1})])),_:1}),d(E,{modelValue:a.securityPhone,"onUpdate:modelValue":t[3]||(t[3]=e=>a.securityPhone=e),placeholder:"请输入网络安全专员联系电话",class:N(["form-input",{error:r.securityPhone}]),type:"number",onBlur:t[4]||(t[4]=e=>f("securityPhone"))},null,8,["modelValue","class"]),r.securityPhone?(n(),c(S,{key:0,class:"error-message"},{default:s((()=>[h(_(r.securityPhone),1)])),_:1})):u("",!0)])),_:1}),d(w,{class:"form-item"},{default:s((()=>[d(S,{class:"form-label"},{default:s((()=>[h("网络安全专员邮箱"),d(S,{class:"required"},{default:s((()=>[h("*")])),_:1})])),_:1}),d(E,{modelValue:a.securityEmail,"onUpdate:modelValue":t[5]||(t[5]=e=>a.securityEmail=e),placeholder:"请输入网络安全专员邮箱",class:N(["form-input",{error:r.securityEmail}]),type:"email",onBlur:t[6]||(t[6]=e=>f("securityEmail"))},null,8,["modelValue","class"]),r.securityEmail?(n(),c(S,{key:0,class:"error-message"},{default:s((()=>[h(_(r.securityEmail),1)])),_:1})):u("",!0)])),_:1}),d(w,{class:"form-item"},{default:s((()=>[d(S,{class:"form-label"},{default:s((()=>[h("部门主管领导"),d(S,{class:"required"},{default:s((()=>[h("*")])),_:1})])),_:1}),d(E,{modelValue:a.deptLeader,"onUpdate:modelValue":t[7]||(t[7]=e=>a.deptLeader=e),placeholder:"请输入部门主管领导",class:N(["form-input",{error:r.deptLeader}]),onBlur:t[8]||(t[8]=e=>f("deptLeader"))},null,8,["modelValue","class"]),r.deptLeader?(n(),c(S,{key:0,class:"error-message"},{default:s((()=>[h(_(r.deptLeader),1)])),_:1})):u("",!0)])),_:1}),d(w,{class:"form-item"},{default:s((()=>[d(S,{class:"form-label"},{default:s((()=>[h("部门主管领导联系电话"),d(S,{class:"required"},{default:s((()=>[h("*")])),_:1})])),_:1}),d(E,{modelValue:a.deptPhone,"onUpdate:modelValue":t[9]||(t[9]=e=>a.deptPhone=e),placeholder:"请输入部门主管领导联系电话",class:N(["form-input",{error:r.deptPhone}]),type:"number",onBlur:t[10]||(t[10]=e=>f("deptPhone"))},null,8,["modelValue","class"]),r.deptPhone?(n(),c(S,{key:0,class:"error-message"},{default:s((()=>[h(_(r.deptPhone),1)])),_:1})):u("",!0)])),_:1}),d(w,{class:"form-item"},{default:s((()=>[d(S,{class:"form-label"},{default:s((()=>[h("部门主管领导邮箱"),d(S,{class:"required"},{default:s((()=>[h("*")])),_:1})])),_:1}),d(E,{modelValue:a.deptEmail,"onUpdate:modelValue":t[11]||(t[11]=e=>a.deptEmail=e),placeholder:"请输入部门主管领导邮箱",class:N(["form-input",{error:r.deptEmail}]),type:"email",onBlur:t[12]||(t[12]=e=>f("deptEmail"))},null,8,["modelValue","class"]),r.deptEmail?(n(),c(S,{key:0,class:"error-message"},{default:s((()=>[h(_(r.deptEmail),1)])),_:1})):u("",!0)])),_:1}),d(w,{class:"form-item"},{default:s((()=>[d(S,{class:"form-label"},{default:s((()=>[h("分管公司领导"),d(S,{class:"required"},{default:s((()=>[h("*")])),_:1})])),_:1}),d(E,{modelValue:a.companyLeader,"onUpdate:modelValue":t[13]||(t[13]=e=>a.companyLeader=e),placeholder:"请输入分管公司领导",class:N(["form-input",{error:r.companyLeader}]),onBlur:t[14]||(t[14]=e=>f("companyLeader"))},null,8,["modelValue","class"]),r.companyLeader?(n(),c(S,{key:0,class:"error-message"},{default:s((()=>[h(_(r.companyLeader),1)])),_:1})):u("",!0)])),_:1}),d(w,{class:"form-item"},{default:s((()=>[d(S,{class:"form-label"},{default:s((()=>[h("分管公司领导联系电话"),d(S,{class:"required"},{default:s((()=>[h("*")])),_:1})])),_:1}),d(E,{modelValue:a.companyPhone,"onUpdate:modelValue":t[15]||(t[15]=e=>a.companyPhone=e),placeholder:"请输入分管公司领导联系电话",class:N(["form-input",{error:r.companyPhone}]),type:"number",onBlur:t[16]||(t[16]=e=>f("companyPhone"))},null,8,["modelValue","class"]),r.companyPhone?(n(),c(S,{key:0,class:"error-message"},{default:s((()=>[h(_(r.companyPhone),1)])),_:1})):u("",!0)])),_:1}),d(w,{class:"form-item"},{default:s((()=>[d(S,{class:"form-label"},{default:s((()=>[h("分管公司领导邮箱"),d(S,{class:"required"},{default:s((()=>[h("*")])),_:1})])),_:1}),d(E,{modelValue:a.companyEmail,"onUpdate:modelValue":t[17]||(t[17]=e=>a.companyEmail=e),placeholder:"请输入分管公司领导邮箱",class:N(["form-input",{error:r.companyEmail}]),type:"email",onBlur:t[18]||(t[18]=e=>f("companyEmail"))},null,8,["modelValue","class"]),r.companyEmail?(n(),c(S,{key:0,class:"error-message"},{default:s((()=>[h(_(r.companyEmail),1)])),_:1})):u("",!0)])),_:1}),d(x,{"form-type":"submit",class:"submit-btn",disabled:p.value},{default:s((()=>[h(_(p.value?"提交中...":"提交"),1)])),_:1},8,["disabled"])])),_:1}),d(x,{"form-type":"submit",class:"submit-btn",onClick:l},{default:s((()=>[h(" 返回 ")])),_:1})])),_:1})}}},[["__scopeId","data-v-7580dd69"]]);export{Q as default};
