import{s as t,o as e,n as o,w as i,i as n,a as s,b as a,e as r,d as l}from"./index-634fa69d.js";import{_ as d}from"./u-button.3f55f15e.js";import{r as p}from"./uni-app.es.78f2cdc8.js";import{F as c}from"./FileSaver.min.c18a2d77.js";import{d as m,f as u}from"./common.c1fe3543.js";import{d as h}from"./index.e8efd85e.js";import{_ as f}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-loading-icon.09a3efa7.js";import"./u-icon.57682e04.js";import"./request.87fc902a.js";const b=f({data:()=>({timer:null,res:"33333",url:"",option:{},res:"",link:""}),onShow(){"notInDingTalk"!==h.env.platform&&h.biz.navigation.setTitle({title:"文件下载"})},onLoad(e){this.option=e,t("token",e.token),this.downloadFun().then((t=>{1==t&&this.isIOS()&&(this.timer=setTimeout((()=>{this.reloadPage()}),3e3),clearInterval(this.timer))}))},methods:{reloadPage(){window.location.reload()},isIOS(){var t=navigator.userAgent.toLowerCase();return/iphone|ipad|ipod/.test(t)},downloadFun(){return new Promise(((t,e)=>{if("1"===this.option.type)m({id:this.option.param1}).then((e=>{let o="blob";".png"!==this.option.param2&&".jpg"!==this.option.param2&&".jpeg"!==this.option.param2||(o="arraybuffer"),this.res=e;const i=new Blob([e],{type:o}),n=document.createElement("a");n.style.display="none",n.href=URL.createObjectURL(i),n.setAttribute("download",`${this.option.param3}${this.option.param2}`),this.link=n,document.body.appendChild(n),n.click(),document.body.removeChild(n),t(1)})).catch((t=>{this.$message.error("下载异常请联系管理员"),e()}));else if("2"===this.option.type){let o=this.getFileExtension(this.option.param2);u(this.option.param1).then((e=>{let i="blob";".png"!==o&&".jpg"!==o&&".jpeg"!==o||(i="arraybuffer");const n=new Blob([e],{type:i}),s=URL.createObjectURL(n),a=document.createElement("a");a.style.display="none",a.href=s,a.setAttribute("download",`${this.option.param2}`),document.body.appendChild(a),console.log(a,"link"),a.click(),document.body.removeChild(a),t(1)})).catch((t=>{this.$message.error("下载异常请联系管理员"),e()}))}}))},getFileExtension(t){const e=t.lastIndexOf(".");return e>0&&e<t.length-1?t.slice(e+1).toLowerCase():""},download(){c.saveAs(this.option.blob,this.option.fileName)},async xhrequest(t,e){let o=t;return await fetch(o).then((t=>t.blob())).then((t=>{var i=o.lastIndexOf("."),n=o.substr(i+1);let s=new Blob([t]);"function"==typeof e&&e(s,n)}))}}},[["render",function(t,c,m,u,h,f){const b=p(l("u-button"),d),g=n;return e(),o(g,null,{default:i((()=>[s("div",{class:"desc"},"请点击刷新按钮自动下载"),s("div",null,"Android用户请手动点击右上角三个点用浏览器打开(建议您使用QQ浏览器)"),s("div",null,"如果您发现您下载的文件不对请按刷新按钮即可"),s("div",{class:"down-button"},[a(b,{onClick:f.downloadFun,shape:"circle",ripple:"","custom-style":{width:"100%",background:"linear-gradient(90deg, #69b0ff, #5f88ff)",color:"#fff"}},{default:i((()=>[r("下载")])),_:1},8,["onClick","custom-style"]),a(b,{onClick:f.reloadPage,shape:"circle",ripple:"","custom-style":{width:"100%",background:"linear-gradient(90deg, #69b0ff, #5f88ff)",color:"#fff",marginTop:"20px"}},{default:i((()=>[r("刷新")])),_:1},8,["onClick","custom-style"])])])),_:1})}],["__scopeId","data-v-cd638756"]]);export{b as default};
